import { consoleWarn } from './console';
import { chunk, padEnd } from './helpers';
import { toXYZ } from './color/transformSRGB';
export function colorToInt(color) {
    let rgb;
    if (typeof color === 'number') {
        rgb = color;
    }
    else if (typeof color === 'string') {
        let c = color[0] === '#' ? color.substring(1) : color;
        if (c.length === 3) {
            c = c.split('').map(char => char + char).join('');
        }
        if (c.length !== 6) {
            consoleWarn(`'${color}' is not a valid rgb color`);
        }
        rgb = parseInt(c, 16);
    }
    else {
        throw new TypeError(`Colors can only be numbers or strings, recieved ${color == null ? color : color.constructor.name} instead`);
    }
    if (rgb < 0) {
        consoleWarn(`Colors cannot be negative: '${color}'`);
        rgb = 0;
    }
    else if (rgb > 0xffffff || isNaN(rgb)) {
        consoleWarn(`'${color}' is not a valid rgb color`);
        rgb = 0xffffff;
    }
    return rgb;
}
export function intToHex(color) {
    let hexColor = color.toString(16);
    if (hexColor.length < 6)
        hexColor = '0'.repeat(6 - hexColor.length) + hexColor;
    return '#' + hexColor;
}
export function colorToHex(color) {
    return intToHex(colorToInt(color));
}
/**
 * Converts HSVA to RGBA. Based on formula from https://en.wikipedia.org/wiki/HSL_and_HSV
 *
 * @param color HSVA color as an array [0-360, 0-1, 0-1, 0-1]
 */
export function HSVAtoRGBA(hsva) {
    const { h, s, v, a } = hsva;
    const f = (n) => {
        const k = (n + (h / 60)) % 6;
        return v - v * s * Math.max(Math.min(k, 4 - k, 1), 0);
    };
    const rgb = [f(5), f(3), f(1)].map(v => Math.round(v * 255));
    return { r: rgb[0], g: rgb[1], b: rgb[2], a };
}
/**
 * Converts RGBA to HSVA. Based on formula from https://en.wikipedia.org/wiki/HSL_and_HSV
 *
 * @param color RGBA color as an array [0-255, 0-255, 0-255, 0-1]
 */
export function RGBAtoHSVA(rgba) {
    if (!rgba)
        return { h: 0, s: 1, v: 1, a: 1 };
    const r = rgba.r / 255;
    const g = rgba.g / 255;
    const b = rgba.b / 255;
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h = 0;
    if (max !== min) {
        if (max === r) {
            h = 60 * (0 + ((g - b) / (max - min)));
        }
        else if (max === g) {
            h = 60 * (2 + ((b - r) / (max - min)));
        }
        else if (max === b) {
            h = 60 * (4 + ((r - g) / (max - min)));
        }
    }
    if (h < 0)
        h = h + 360;
    const s = max === 0 ? 0 : (max - min) / max;
    const hsv = [h, s, max];
    return { h: hsv[0], s: hsv[1], v: hsv[2], a: rgba.a };
}
export function HSVAtoHSLA(hsva) {
    const { h, s, v, a } = hsva;
    const l = v - (v * s / 2);
    const sprime = l === 1 || l === 0 ? 0 : (v - l) / Math.min(l, 1 - l);
    return { h, s: sprime, l, a };
}
export function HSLAtoHSVA(hsl) {
    const { h, s, l, a } = hsl;
    const v = l + s * Math.min(l, 1 - l);
    const sprime = v === 0 ? 0 : 2 - (2 * l / v);
    return { h, s: sprime, v, a };
}
export function RGBAtoCSS(rgba) {
    return `rgba(${rgba.r}, ${rgba.g}, ${rgba.b}, ${rgba.a})`;
}
export function RGBtoCSS(rgba) {
    return RGBAtoCSS({ ...rgba, a: 1 });
}
export function RGBAtoHex(rgba) {
    const toHex = (v) => {
        const h = Math.round(v).toString(16);
        return ('00'.substr(0, 2 - h.length) + h).toUpperCase();
    };
    return `#${[
        toHex(rgba.r),
        toHex(rgba.g),
        toHex(rgba.b),
        toHex(Math.round(rgba.a * 255)),
    ].join('')}`;
}
export function HexToRGBA(hex) {
    const rgba = chunk(hex.slice(1), 2).map((c) => parseInt(c, 16));
    return {
        r: rgba[0],
        g: rgba[1],
        b: rgba[2],
        a: Math.round((rgba[3] / 255) * 100) / 100,
    };
}
export function HexToHSVA(hex) {
    const rgb = HexToRGBA(hex);
    return RGBAtoHSVA(rgb);
}
export function HSVAtoHex(hsva) {
    return RGBAtoHex(HSVAtoRGBA(hsva));
}
export function parseHex(hex) {
    if (hex.startsWith('#')) {
        hex = hex.slice(1);
    }
    hex = hex.replace(/([^0-9a-f])/gi, 'F');
    if (hex.length === 3) {
        hex = hex.split('').map(x => x + x).join('');
    }
    if (hex.length === 6) {
        hex = padEnd(hex, 8, 'F');
    }
    else {
        hex = padEnd(padEnd(hex, 6), 8, 'F');
    }
    return `#${hex}`.toUpperCase().substr(0, 9);
}
export function RGBtoInt(rgba) {
    return (rgba.r << 16) + (rgba.g << 8) + rgba.b;
}
/**
 * Returns the contrast ratio (1-21) between two colors.
 *
 * @param c1 First color
 * @param c2 Second color
 */
export function contrastRatio(c1, c2) {
    const [, y1] = toXYZ(RGBtoInt(c1));
    const [, y2] = toXYZ(RGBtoInt(c2));
    return (Math.max(y1, y2) + 0.05) / (Math.min(y1, y2) + 0.05);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JVdGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2NvbG9yVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUN2QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUN6QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFlN0MsTUFBTSxVQUFVLFVBQVUsQ0FBRSxLQUFZO0lBQ3RDLElBQUksR0FBRyxDQUFBO0lBRVAsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7UUFDN0IsR0FBRyxHQUFHLEtBQUssQ0FBQTtLQUNaO1NBQU0sSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7UUFDcEMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFBO1FBQ3JELElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDbEIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtTQUNsRDtRQUNELElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDbEIsV0FBVyxDQUFDLElBQUksS0FBSyw0QkFBNEIsQ0FBQyxDQUFBO1NBQ25EO1FBQ0QsR0FBRyxHQUFHLFFBQVEsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7S0FDdEI7U0FBTTtRQUNMLE1BQU0sSUFBSSxTQUFTLENBQUMsbURBQW1ELEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFBO0tBQ2pJO0lBRUQsSUFBSSxHQUFHLEdBQUcsQ0FBQyxFQUFFO1FBQ1gsV0FBVyxDQUFDLCtCQUErQixLQUFLLEdBQUcsQ0FBQyxDQUFBO1FBQ3BELEdBQUcsR0FBRyxDQUFDLENBQUE7S0FDUjtTQUFNLElBQUksR0FBRyxHQUFHLFFBQVEsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDdkMsV0FBVyxDQUFDLElBQUksS0FBSyw0QkFBNEIsQ0FBQyxDQUFBO1FBQ2xELEdBQUcsR0FBRyxRQUFRLENBQUE7S0FDZjtJQUVELE9BQU8sR0FBRyxDQUFBO0FBQ1osQ0FBQztBQUVELE1BQU0sVUFBVSxRQUFRLENBQUUsS0FBZTtJQUN2QyxJQUFJLFFBQVEsR0FBVyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBRXpDLElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQUUsUUFBUSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxRQUFRLENBQUE7SUFFOUUsT0FBTyxHQUFHLEdBQUcsUUFBUSxDQUFBO0FBQ3ZCLENBQUM7QUFFRCxNQUFNLFVBQVUsVUFBVSxDQUFFLEtBQVk7SUFDdEMsT0FBTyxRQUFRLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7QUFDcEMsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxNQUFNLFVBQVUsVUFBVSxDQUFFLElBQVU7SUFDcEMsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQTtJQUMzQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQVMsRUFBRSxFQUFFO1FBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQzVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ3ZELENBQUMsQ0FBQTtJQUVELE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRTVELE9BQU8sRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQTtBQUMvQyxDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxVQUFVLENBQUUsSUFBVTtJQUNwQyxJQUFJLENBQUMsSUFBSTtRQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7SUFFNUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUE7SUFDdEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUE7SUFDdEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUE7SUFDdEIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQzdCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUU3QixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7SUFFVCxJQUFJLEdBQUcsS0FBSyxHQUFHLEVBQUU7UUFDZixJQUFJLEdBQUcsS0FBSyxDQUFDLEVBQUU7WUFDYixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO1NBQ3ZDO2FBQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxFQUFFO1lBQ3BCLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDdkM7YUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEVBQUU7WUFDcEIsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUN2QztLQUNGO0lBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQztRQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFBO0lBRXRCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFBO0lBQzNDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUV2QixPQUFPLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQTtBQUN2RCxDQUFDO0FBRUQsTUFBTSxVQUFVLFVBQVUsQ0FBRSxJQUFVO0lBQ3BDLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUE7SUFFM0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUV6QixNQUFNLE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRXBFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7QUFDL0IsQ0FBQztBQUVELE1BQU0sVUFBVSxVQUFVLENBQUUsR0FBUztJQUNuQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFBO0lBRTFCLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRXBDLE1BQU0sTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUU1QyxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFBO0FBQy9CLENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFFLElBQVU7SUFDbkMsT0FBTyxRQUFRLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQTtBQUMzRCxDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FBRSxJQUFVO0lBQ2xDLE9BQU8sU0FBUyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUE7QUFDckMsQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQUUsSUFBVTtJQUNuQyxNQUFNLEtBQUssR0FBRyxDQUFDLENBQVMsRUFBRSxFQUFFO1FBQzFCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ3BDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFBO0lBQ3pELENBQUMsQ0FBQTtJQUVELE9BQU8sSUFBSTtRQUNULEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2IsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDYixLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNiLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7S0FDaEMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQTtBQUNkLENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFFLEdBQVE7SUFDakMsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBUyxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFFdkUsT0FBTztRQUNMLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1YsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDVixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNWLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUc7S0FDM0MsQ0FBQTtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFFLEdBQVE7SUFDakMsTUFBTSxHQUFHLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQzFCLE9BQU8sVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBQ3hCLENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFFLElBQVU7SUFDbkMsT0FBTyxTQUFTLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7QUFDcEMsQ0FBQztBQUVELE1BQU0sVUFBVSxRQUFRLENBQUUsR0FBVztJQUNuQyxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDdkIsR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7S0FDbkI7SUFFRCxHQUFHLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFFdkMsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUNwQixHQUFHLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0tBQzdDO0lBRUQsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUNwQixHQUFHLEdBQUcsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUE7S0FDMUI7U0FBTTtRQUNMLEdBQUcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUE7S0FDckM7SUFFRCxPQUFPLElBQUksR0FBRyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUM3QyxDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FBRSxJQUFVO0lBQ2xDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFBO0FBQ2hELENBQUM7QUFFRDs7Ozs7R0FLRztBQUNILE1BQU0sVUFBVSxhQUFhLENBQUUsRUFBUSxFQUFFLEVBQVE7SUFDL0MsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ2xDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUVsQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQTtBQUM5RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29uc29sZVdhcm4gfSBmcm9tICcuL2NvbnNvbGUnXG5pbXBvcnQgeyBjaHVuaywgcGFkRW5kIH0gZnJvbSAnLi9oZWxwZXJzJ1xuaW1wb3J0IHsgdG9YWVogfSBmcm9tICcuL2NvbG9yL3RyYW5zZm9ybVNSR0InXG5cbmV4cG9ydCB0eXBlIENvbG9ySW50ID0gbnVtYmVyXG5leHBvcnQgdHlwZSBYWVogPSBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl1cbmV4cG9ydCB0eXBlIExBQiA9IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXVxuZXhwb3J0IHR5cGUgSFNWID0geyBoOiBudW1iZXIsIHM6IG51bWJlciwgdjogbnVtYmVyIH1cbmV4cG9ydCB0eXBlIEhTVkEgPSBIU1YgJiB7IGE6IG51bWJlciB9XG5leHBvcnQgdHlwZSBSR0IgPSB7IHI6IG51bWJlciwgZzogbnVtYmVyLCBiOiBudW1iZXIgfVxuZXhwb3J0IHR5cGUgUkdCQSA9IFJHQiAmIHsgYTogbnVtYmVyIH1cbmV4cG9ydCB0eXBlIEhTTCA9IHsgaDogbnVtYmVyLCBzOiBudW1iZXIsIGw6IG51bWJlciB9XG5leHBvcnQgdHlwZSBIU0xBID0gSFNMICYgeyBhOiBudW1iZXIgfVxuZXhwb3J0IHR5cGUgSGV4ID0gc3RyaW5nXG5leHBvcnQgdHlwZSBIZXhhID0gc3RyaW5nXG5leHBvcnQgdHlwZSBDb2xvciA9IHN0cmluZyB8IG51bWJlciB8IHt9XG5cbmV4cG9ydCBmdW5jdGlvbiBjb2xvclRvSW50IChjb2xvcjogQ29sb3IpOiBDb2xvckludCB7XG4gIGxldCByZ2JcblxuICBpZiAodHlwZW9mIGNvbG9yID09PSAnbnVtYmVyJykge1xuICAgIHJnYiA9IGNvbG9yXG4gIH0gZWxzZSBpZiAodHlwZW9mIGNvbG9yID09PSAnc3RyaW5nJykge1xuICAgIGxldCBjID0gY29sb3JbMF0gPT09ICcjJyA/IGNvbG9yLnN1YnN0cmluZygxKSA6IGNvbG9yXG4gICAgaWYgKGMubGVuZ3RoID09PSAzKSB7XG4gICAgICBjID0gYy5zcGxpdCgnJykubWFwKGNoYXIgPT4gY2hhciArIGNoYXIpLmpvaW4oJycpXG4gICAgfVxuICAgIGlmIChjLmxlbmd0aCAhPT0gNikge1xuICAgICAgY29uc29sZVdhcm4oYCcke2NvbG9yfScgaXMgbm90IGEgdmFsaWQgcmdiIGNvbG9yYClcbiAgICB9XG4gICAgcmdiID0gcGFyc2VJbnQoYywgMTYpXG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgQ29sb3JzIGNhbiBvbmx5IGJlIG51bWJlcnMgb3Igc3RyaW5ncywgcmVjaWV2ZWQgJHtjb2xvciA9PSBudWxsID8gY29sb3IgOiBjb2xvci5jb25zdHJ1Y3Rvci5uYW1lfSBpbnN0ZWFkYClcbiAgfVxuXG4gIGlmIChyZ2IgPCAwKSB7XG4gICAgY29uc29sZVdhcm4oYENvbG9ycyBjYW5ub3QgYmUgbmVnYXRpdmU6ICcke2NvbG9yfSdgKVxuICAgIHJnYiA9IDBcbiAgfSBlbHNlIGlmIChyZ2IgPiAweGZmZmZmZiB8fCBpc05hTihyZ2IpKSB7XG4gICAgY29uc29sZVdhcm4oYCcke2NvbG9yfScgaXMgbm90IGEgdmFsaWQgcmdiIGNvbG9yYClcbiAgICByZ2IgPSAweGZmZmZmZlxuICB9XG5cbiAgcmV0dXJuIHJnYlxufVxuXG5leHBvcnQgZnVuY3Rpb24gaW50VG9IZXggKGNvbG9yOiBDb2xvckludCk6IHN0cmluZyB7XG4gIGxldCBoZXhDb2xvcjogc3RyaW5nID0gY29sb3IudG9TdHJpbmcoMTYpXG5cbiAgaWYgKGhleENvbG9yLmxlbmd0aCA8IDYpIGhleENvbG9yID0gJzAnLnJlcGVhdCg2IC0gaGV4Q29sb3IubGVuZ3RoKSArIGhleENvbG9yXG5cbiAgcmV0dXJuICcjJyArIGhleENvbG9yXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb2xvclRvSGV4IChjb2xvcjogQ29sb3IpOiBzdHJpbmcge1xuICByZXR1cm4gaW50VG9IZXgoY29sb3JUb0ludChjb2xvcikpXG59XG5cbi8qKlxuICogQ29udmVydHMgSFNWQSB0byBSR0JBLiBCYXNlZCBvbiBmb3JtdWxhIGZyb20gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSFNMX2FuZF9IU1ZcbiAqXG4gKiBAcGFyYW0gY29sb3IgSFNWQSBjb2xvciBhcyBhbiBhcnJheSBbMC0zNjAsIDAtMSwgMC0xLCAwLTFdXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBIU1ZBdG9SR0JBIChoc3ZhOiBIU1ZBKTogUkdCQSB7XG4gIGNvbnN0IHsgaCwgcywgdiwgYSB9ID0gaHN2YVxuICBjb25zdCBmID0gKG46IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IGsgPSAobiArIChoIC8gNjApKSAlIDZcbiAgICByZXR1cm4gdiAtIHYgKiBzICogTWF0aC5tYXgoTWF0aC5taW4oaywgNCAtIGssIDEpLCAwKVxuICB9XG5cbiAgY29uc3QgcmdiID0gW2YoNSksIGYoMyksIGYoMSldLm1hcCh2ID0+IE1hdGgucm91bmQodiAqIDI1NSkpXG5cbiAgcmV0dXJuIHsgcjogcmdiWzBdLCBnOiByZ2JbMV0sIGI6IHJnYlsyXSwgYSB9XG59XG5cbi8qKlxuICogQ29udmVydHMgUkdCQSB0byBIU1ZBLiBCYXNlZCBvbiBmb3JtdWxhIGZyb20gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSFNMX2FuZF9IU1ZcbiAqXG4gKiBAcGFyYW0gY29sb3IgUkdCQSBjb2xvciBhcyBhbiBhcnJheSBbMC0yNTUsIDAtMjU1LCAwLTI1NSwgMC0xXVxuICovXG5leHBvcnQgZnVuY3Rpb24gUkdCQXRvSFNWQSAocmdiYTogUkdCQSk6IEhTVkEge1xuICBpZiAoIXJnYmEpIHJldHVybiB7IGg6IDAsIHM6IDEsIHY6IDEsIGE6IDEgfVxuXG4gIGNvbnN0IHIgPSByZ2JhLnIgLyAyNTVcbiAgY29uc3QgZyA9IHJnYmEuZyAvIDI1NVxuICBjb25zdCBiID0gcmdiYS5iIC8gMjU1XG4gIGNvbnN0IG1heCA9IE1hdGgubWF4KHIsIGcsIGIpXG4gIGNvbnN0IG1pbiA9IE1hdGgubWluKHIsIGcsIGIpXG5cbiAgbGV0IGggPSAwXG5cbiAgaWYgKG1heCAhPT0gbWluKSB7XG4gICAgaWYgKG1heCA9PT0gcikge1xuICAgICAgaCA9IDYwICogKDAgKyAoKGcgLSBiKSAvIChtYXggLSBtaW4pKSlcbiAgICB9IGVsc2UgaWYgKG1heCA9PT0gZykge1xuICAgICAgaCA9IDYwICogKDIgKyAoKGIgLSByKSAvIChtYXggLSBtaW4pKSlcbiAgICB9IGVsc2UgaWYgKG1heCA9PT0gYikge1xuICAgICAgaCA9IDYwICogKDQgKyAoKHIgLSBnKSAvIChtYXggLSBtaW4pKSlcbiAgICB9XG4gIH1cblxuICBpZiAoaCA8IDApIGggPSBoICsgMzYwXG5cbiAgY29uc3QgcyA9IG1heCA9PT0gMCA/IDAgOiAobWF4IC0gbWluKSAvIG1heFxuICBjb25zdCBoc3YgPSBbaCwgcywgbWF4XVxuXG4gIHJldHVybiB7IGg6IGhzdlswXSwgczogaHN2WzFdLCB2OiBoc3ZbMl0sIGE6IHJnYmEuYSB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBIU1ZBdG9IU0xBIChoc3ZhOiBIU1ZBKTogSFNMQSB7XG4gIGNvbnN0IHsgaCwgcywgdiwgYSB9ID0gaHN2YVxuXG4gIGNvbnN0IGwgPSB2IC0gKHYgKiBzIC8gMilcblxuICBjb25zdCBzcHJpbWUgPSBsID09PSAxIHx8IGwgPT09IDAgPyAwIDogKHYgLSBsKSAvIE1hdGgubWluKGwsIDEgLSBsKVxuXG4gIHJldHVybiB7IGgsIHM6IHNwcmltZSwgbCwgYSB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBIU0xBdG9IU1ZBIChoc2w6IEhTTEEpOiBIU1ZBIHtcbiAgY29uc3QgeyBoLCBzLCBsLCBhIH0gPSBoc2xcblxuICBjb25zdCB2ID0gbCArIHMgKiBNYXRoLm1pbihsLCAxIC0gbClcblxuICBjb25zdCBzcHJpbWUgPSB2ID09PSAwID8gMCA6IDIgLSAoMiAqIGwgLyB2KVxuXG4gIHJldHVybiB7IGgsIHM6IHNwcmltZSwgdiwgYSB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBSR0JBdG9DU1MgKHJnYmE6IFJHQkEpOiBzdHJpbmcge1xuICByZXR1cm4gYHJnYmEoJHtyZ2JhLnJ9LCAke3JnYmEuZ30sICR7cmdiYS5ifSwgJHtyZ2JhLmF9KWBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFJHQnRvQ1NTIChyZ2JhOiBSR0JBKTogc3RyaW5nIHtcbiAgcmV0dXJuIFJHQkF0b0NTUyh7IC4uLnJnYmEsIGE6IDEgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFJHQkF0b0hleCAocmdiYTogUkdCQSk6IEhleCB7XG4gIGNvbnN0IHRvSGV4ID0gKHY6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IGggPSBNYXRoLnJvdW5kKHYpLnRvU3RyaW5nKDE2KVxuICAgIHJldHVybiAoJzAwJy5zdWJzdHIoMCwgMiAtIGgubGVuZ3RoKSArIGgpLnRvVXBwZXJDYXNlKClcbiAgfVxuXG4gIHJldHVybiBgIyR7W1xuICAgIHRvSGV4KHJnYmEuciksXG4gICAgdG9IZXgocmdiYS5nKSxcbiAgICB0b0hleChyZ2JhLmIpLFxuICAgIHRvSGV4KE1hdGgucm91bmQocmdiYS5hICogMjU1KSksXG4gIF0uam9pbignJyl9YFxufVxuXG5leHBvcnQgZnVuY3Rpb24gSGV4VG9SR0JBIChoZXg6IEhleCk6IFJHQkEge1xuICBjb25zdCByZ2JhID0gY2h1bmsoaGV4LnNsaWNlKDEpLCAyKS5tYXAoKGM6IHN0cmluZykgPT4gcGFyc2VJbnQoYywgMTYpKVxuXG4gIHJldHVybiB7XG4gICAgcjogcmdiYVswXSxcbiAgICBnOiByZ2JhWzFdLFxuICAgIGI6IHJnYmFbMl0sXG4gICAgYTogTWF0aC5yb3VuZCgocmdiYVszXSAvIDI1NSkgKiAxMDApIC8gMTAwLFxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBIZXhUb0hTVkEgKGhleDogSGV4KTogSFNWQSB7XG4gIGNvbnN0IHJnYiA9IEhleFRvUkdCQShoZXgpXG4gIHJldHVybiBSR0JBdG9IU1ZBKHJnYilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEhTVkF0b0hleCAoaHN2YTogSFNWQSk6IEhleCB7XG4gIHJldHVybiBSR0JBdG9IZXgoSFNWQXRvUkdCQShoc3ZhKSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlSGV4IChoZXg6IHN0cmluZyk6IEhleCB7XG4gIGlmIChoZXguc3RhcnRzV2l0aCgnIycpKSB7XG4gICAgaGV4ID0gaGV4LnNsaWNlKDEpXG4gIH1cblxuICBoZXggPSBoZXgucmVwbGFjZSgvKFteMC05YS1mXSkvZ2ksICdGJylcblxuICBpZiAoaGV4Lmxlbmd0aCA9PT0gMykge1xuICAgIGhleCA9IGhleC5zcGxpdCgnJykubWFwKHggPT4geCArIHgpLmpvaW4oJycpXG4gIH1cblxuICBpZiAoaGV4Lmxlbmd0aCA9PT0gNikge1xuICAgIGhleCA9IHBhZEVuZChoZXgsIDgsICdGJylcbiAgfSBlbHNlIHtcbiAgICBoZXggPSBwYWRFbmQocGFkRW5kKGhleCwgNiksIDgsICdGJylcbiAgfVxuXG4gIHJldHVybiBgIyR7aGV4fWAudG9VcHBlckNhc2UoKS5zdWJzdHIoMCwgOSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFJHQnRvSW50IChyZ2JhOiBSR0JBKTogQ29sb3JJbnQge1xuICByZXR1cm4gKHJnYmEuciA8PCAxNikgKyAocmdiYS5nIDw8IDgpICsgcmdiYS5iXG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgY29udHJhc3QgcmF0aW8gKDEtMjEpIGJldHdlZW4gdHdvIGNvbG9ycy5cbiAqXG4gKiBAcGFyYW0gYzEgRmlyc3QgY29sb3JcbiAqIEBwYXJhbSBjMiBTZWNvbmQgY29sb3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnRyYXN0UmF0aW8gKGMxOiBSR0JBLCBjMjogUkdCQSk6IG51bWJlciB7XG4gIGNvbnN0IFssIHkxXSA9IHRvWFlaKFJHQnRvSW50KGMxKSlcbiAgY29uc3QgWywgeTJdID0gdG9YWVooUkdCdG9JbnQoYzIpKVxuXG4gIHJldHVybiAoTWF0aC5tYXgoeTEsIHkyKSArIDAuMDUpIC8gKE1hdGgubWluKHkxLCB5MikgKyAwLjA1KVxufVxuIl19