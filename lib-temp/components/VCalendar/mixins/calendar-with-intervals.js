// Mixins
import CalendarBase from './calendar-base';
// Util
import props from '../util/props';
import { parseTime, copyTimestamp, updateMinutes, createDayList, createIntervalList, createNativeLocaleFormatter, } from '../util/timestamp';
/* @vue/component */
export default CalendarBase.extend({
    name: 'calendar-with-intervals',
    props: props.intervals,
    computed: {
        parsedFirstInterval() {
            return parseInt(this.firstInterval);
        },
        parsedIntervalMinutes() {
            return parseInt(this.intervalMinutes);
        },
        parsedIntervalCount() {
            return parseInt(this.intervalCount);
        },
        parsedIntervalHeight() {
            return parseFloat(this.intervalHeight);
        },
        firstMinute() {
            return this.parsedFirstInterval * this.parsedIntervalMinutes;
        },
        bodyHeight() {
            return this.parsedIntervalCount * this.parsedIntervalHeight;
        },
        days() {
            return createDayList(this.parsedStart, this.parsedEnd, this.times.today, this.weekdaySkips, this.maxDays);
        },
        intervals() {
            const days = this.days;
            const first = this.parsedFirstInterval;
            const minutes = this.parsedIntervalMinutes;
            const count = this.parsedIntervalCount;
            const now = this.times.now;
            return days.map(d => createIntervalList(d, first, minutes, count, now));
        },
        intervalFormatter() {
            if (this.intervalFormat) {
                return this.intervalFormat;
            }
            const longOptions = { timeZone: 'UTC', hour: '2-digit', minute: '2-digit' };
            const shortOptions = { timeZone: 'UTC', hour: 'numeric', minute: '2-digit' };
            const shortHourOptions = { timeZone: 'UTC', hour: 'numeric' };
            return createNativeLocaleFormatter(this.currentLocale, (tms, short) => short ? (tms.minute === 0 ? shortHourOptions : shortOptions) : longOptions);
        },
    },
    methods: {
        showIntervalLabelDefault(interval) {
            const first = this.intervals[0][0];
            const isFirst = first.hour === interval.hour && first.minute === interval.minute;
            return !isFirst;
        },
        intervalStyleDefault(_interval) {
            return undefined;
        },
        getTimestampAtEvent(e, day) {
            const timestamp = copyTimestamp(day);
            const bounds = e.currentTarget.getBoundingClientRect();
            const baseMinutes = this.firstMinute;
            const touchEvent = e;
            const mouseEvent = e;
            const touches = touchEvent.changedTouches || touchEvent.touches;
            const clientY = touches && touches[0] ? touches[0].clientY : mouseEvent.clientY;
            const addIntervals = (clientY - bounds.top) / this.parsedIntervalHeight;
            const addMinutes = Math.floor(addIntervals * this.parsedIntervalMinutes);
            const minutes = baseMinutes + addMinutes;
            return updateMinutes(timestamp, minutes, this.times.now);
        },
        getSlotScope(timestamp) {
            const scope = copyTimestamp(timestamp);
            scope.timeToY = this.timeToY;
            scope.minutesToPixels = this.minutesToPixels;
            scope.week = this.days;
            return scope;
        },
        scrollToTime(time) {
            const y = this.timeToY(time);
            const pane = this.$refs.scrollArea;
            if (y === false || !pane) {
                return false;
            }
            pane.scrollTop = y;
            return true;
        },
        minutesToPixels(minutes) {
            return minutes / this.parsedIntervalMinutes * this.parsedIntervalHeight;
        },
        timeToY(time, clamp = true) {
            const minutes = parseTime(time);
            if (minutes === false) {
                return false;
            }
            const min = this.firstMinute;
            const gap = this.parsedIntervalCount * this.parsedIntervalMinutes;
            const delta = (minutes - min) / gap;
            let y = delta * this.bodyHeight;
            if (clamp) {
                if (y < 0) {
                    y = 0;
                }
                if (y > this.bodyHeight) {
                    y = this.bodyHeight;
                }
            }
            return y;
        },
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItd2l0aC1pbnRlcnZhbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WQ2FsZW5kYXIvbWl4aW5zL2NhbGVuZGFyLXdpdGgtaW50ZXJ2YWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLFNBQVM7QUFDVCxPQUFPLFlBQVksTUFBTSxpQkFBaUIsQ0FBQTtBQUUxQyxPQUFPO0FBQ1AsT0FBTyxLQUFLLE1BQU0sZUFBZSxDQUFBO0FBQ2pDLE9BQU8sRUFDTCxTQUFTLEVBQ1QsYUFBYSxFQUNiLGFBQWEsRUFDYixhQUFhLEVBQ2Isa0JBQWtCLEVBQ2xCLDJCQUEyQixHQUU1QixNQUFNLG1CQUFtQixDQUFBO0FBRzFCLG9CQUFvQjtBQUNwQixlQUFlLFlBQVksQ0FBQyxNQUFNLENBQUM7SUFDakMsSUFBSSxFQUFFLHlCQUF5QjtJQUUvQixLQUFLLEVBQUUsS0FBSyxDQUFDLFNBQVM7SUFFdEIsUUFBUSxFQUFFO1FBQ1IsbUJBQW1CO1lBQ2pCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUNyQyxDQUFDO1FBQ0QscUJBQXFCO1lBQ25CLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQTtRQUN2QyxDQUFDO1FBQ0QsbUJBQW1CO1lBQ2pCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUNyQyxDQUFDO1FBQ0Qsb0JBQW9CO1lBQ2xCLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQTtRQUN4QyxDQUFDO1FBQ0QsV0FBVztZQUNULE9BQU8sSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQTtRQUM5RCxDQUFDO1FBQ0QsVUFBVTtZQUNSLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQTtRQUM3RCxDQUFDO1FBQ0QsSUFBSTtZQUNGLE9BQU8sYUFBYSxDQUNsQixJQUFJLENBQUMsV0FBVyxFQUNoQixJQUFJLENBQUMsU0FBUyxFQUNkLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUNoQixJQUFJLENBQUMsWUFBWSxFQUNqQixJQUFJLENBQUMsT0FBTyxDQUNiLENBQUE7UUFDSCxDQUFDO1FBQ0QsU0FBUztZQUNQLE1BQU0sSUFBSSxHQUF3QixJQUFJLENBQUMsSUFBSSxDQUFBO1lBQzNDLE1BQU0sS0FBSyxHQUFXLElBQUksQ0FBQyxtQkFBbUIsQ0FBQTtZQUM5QyxNQUFNLE9BQU8sR0FBVyxJQUFJLENBQUMscUJBQXFCLENBQUE7WUFDbEQsTUFBTSxLQUFLLEdBQVcsSUFBSSxDQUFDLG1CQUFtQixDQUFBO1lBQzlDLE1BQU0sR0FBRyxHQUFzQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQTtZQUU3QyxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUN6RSxDQUFDO1FBQ0QsaUJBQWlCO1lBQ2YsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFO2dCQUN2QixPQUFPLElBQUksQ0FBQyxjQUFtQyxDQUFBO2FBQ2hEO1lBRUQsTUFBTSxXQUFXLEdBQUcsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxDQUFBO1lBQzNFLE1BQU0sWUFBWSxHQUFHLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsQ0FBQTtZQUM1RSxNQUFNLGdCQUFnQixHQUFHLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUE7WUFFN0QsT0FBTywyQkFBMkIsQ0FDaEMsSUFBSSxDQUFDLGFBQWEsRUFDbEIsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUMzRixDQUFBO1FBQ0gsQ0FBQztLQUNGO0lBRUQsT0FBTyxFQUFFO1FBQ1Asd0JBQXdCLENBQUUsUUFBMkI7WUFDbkQsTUFBTSxLQUFLLEdBQXNCLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDckQsTUFBTSxPQUFPLEdBQVksS0FBSyxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssUUFBUSxDQUFDLE1BQU0sQ0FBQTtZQUN6RixPQUFPLENBQUMsT0FBTyxDQUFBO1FBQ2pCLENBQUM7UUFDRCxvQkFBb0IsQ0FBRSxTQUE0QjtZQUNoRCxPQUFPLFNBQVMsQ0FBQTtRQUNsQixDQUFDO1FBQ0QsbUJBQW1CLENBQUUsQ0FBMEIsRUFBRSxHQUFzQjtZQUNyRSxNQUFNLFNBQVMsR0FBc0IsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ3ZELE1BQU0sTUFBTSxHQUFJLENBQUMsQ0FBQyxhQUE2QixDQUFDLHFCQUFxQixFQUFFLENBQUE7WUFDdkUsTUFBTSxXQUFXLEdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQTtZQUM1QyxNQUFNLFVBQVUsR0FBZSxDQUFlLENBQUE7WUFDOUMsTUFBTSxVQUFVLEdBQWUsQ0FBZSxDQUFBO1lBQzlDLE1BQU0sT0FBTyxHQUFjLFVBQVUsQ0FBQyxjQUFjLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQTtZQUMxRSxNQUFNLE9BQU8sR0FBVyxPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFBO1lBQ3ZGLE1BQU0sWUFBWSxHQUFXLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUE7WUFDL0UsTUFBTSxVQUFVLEdBQVcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUE7WUFDaEYsTUFBTSxPQUFPLEdBQVcsV0FBVyxHQUFHLFVBQVUsQ0FBQTtZQUVoRCxPQUFPLGFBQWEsQ0FBQyxTQUFTLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDMUQsQ0FBQztRQUNELFlBQVksQ0FBRSxTQUE0QjtZQUN4QyxNQUFNLEtBQUssR0FBRyxhQUFhLENBQUMsU0FBUyxDQUFRLENBQUE7WUFDN0MsS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFBO1lBQzVCLEtBQUssQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQTtZQUM1QyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7WUFDdEIsT0FBTyxLQUFLLENBQUE7UUFDZCxDQUFDO1FBQ0QsWUFBWSxDQUFFLElBQVc7WUFDdkIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUM1QixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQXlCLENBQUE7WUFFakQsSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsSUFBSSxFQUFFO2dCQUN4QixPQUFPLEtBQUssQ0FBQTthQUNiO1lBRUQsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUE7WUFFbEIsT0FBTyxJQUFJLENBQUE7UUFDYixDQUFDO1FBQ0QsZUFBZSxDQUFFLE9BQWU7WUFDOUIsT0FBTyxPQUFPLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQTtRQUN6RSxDQUFDO1FBQ0QsT0FBTyxDQUFFLElBQVcsRUFBRSxLQUFLLEdBQUcsSUFBSTtZQUNoQyxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUE7WUFFL0IsSUFBSSxPQUFPLEtBQUssS0FBSyxFQUFFO2dCQUNyQixPQUFPLEtBQUssQ0FBQTthQUNiO1lBRUQsTUFBTSxHQUFHLEdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQTtZQUNwQyxNQUFNLEdBQUcsR0FBVyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFBO1lBQ3pFLE1BQU0sS0FBSyxHQUFXLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQTtZQUMzQyxJQUFJLENBQUMsR0FBVyxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQTtZQUV2QyxJQUFJLEtBQUssRUFBRTtnQkFDVCxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUU7b0JBQ1QsQ0FBQyxHQUFHLENBQUMsQ0FBQTtpQkFDTjtnQkFDRCxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFO29CQUN2QixDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQTtpQkFDcEI7YUFDRjtZQUVELE9BQU8sQ0FBQyxDQUFBO1FBQ1YsQ0FBQztLQUNGO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLyBNaXhpbnNcbmltcG9ydCBDYWxlbmRhckJhc2UgZnJvbSAnLi9jYWxlbmRhci1iYXNlJ1xuXG4vLyBVdGlsXG5pbXBvcnQgcHJvcHMgZnJvbSAnLi4vdXRpbC9wcm9wcydcbmltcG9ydCB7XG4gIHBhcnNlVGltZSxcbiAgY29weVRpbWVzdGFtcCxcbiAgdXBkYXRlTWludXRlcyxcbiAgY3JlYXRlRGF5TGlzdCxcbiAgY3JlYXRlSW50ZXJ2YWxMaXN0LFxuICBjcmVhdGVOYXRpdmVMb2NhbGVGb3JtYXR0ZXIsXG4gIFZUaW1lLFxufSBmcm9tICcuLi91dGlsL3RpbWVzdGFtcCdcbmltcG9ydCB7IENhbGVuZGFyVGltZXN0YW1wLCBDYWxlbmRhckZvcm1hdHRlciB9IGZyb20gJ3R5cGVzJ1xuXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xuZXhwb3J0IGRlZmF1bHQgQ2FsZW5kYXJCYXNlLmV4dGVuZCh7XG4gIG5hbWU6ICdjYWxlbmRhci13aXRoLWludGVydmFscycsXG5cbiAgcHJvcHM6IHByb3BzLmludGVydmFscyxcblxuICBjb21wdXRlZDoge1xuICAgIHBhcnNlZEZpcnN0SW50ZXJ2YWwgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5maXJzdEludGVydmFsKVxuICAgIH0sXG4gICAgcGFyc2VkSW50ZXJ2YWxNaW51dGVzICgpOiBudW1iZXIge1xuICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMuaW50ZXJ2YWxNaW51dGVzKVxuICAgIH0sXG4gICAgcGFyc2VkSW50ZXJ2YWxDb3VudCAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLmludGVydmFsQ291bnQpXG4gICAgfSxcbiAgICBwYXJzZWRJbnRlcnZhbEhlaWdodCAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHRoaXMuaW50ZXJ2YWxIZWlnaHQpXG4gICAgfSxcbiAgICBmaXJzdE1pbnV0ZSAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZpcnN0SW50ZXJ2YWwgKiB0aGlzLnBhcnNlZEludGVydmFsTWludXRlc1xuICAgIH0sXG4gICAgYm9keUhlaWdodCAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiB0aGlzLnBhcnNlZEludGVydmFsQ291bnQgKiB0aGlzLnBhcnNlZEludGVydmFsSGVpZ2h0XG4gICAgfSxcbiAgICBkYXlzICgpOiBDYWxlbmRhclRpbWVzdGFtcFtdIHtcbiAgICAgIHJldHVybiBjcmVhdGVEYXlMaXN0KFxuICAgICAgICB0aGlzLnBhcnNlZFN0YXJ0LFxuICAgICAgICB0aGlzLnBhcnNlZEVuZCxcbiAgICAgICAgdGhpcy50aW1lcy50b2RheSxcbiAgICAgICAgdGhpcy53ZWVrZGF5U2tpcHMsXG4gICAgICAgIHRoaXMubWF4RGF5c1xuICAgICAgKVxuICAgIH0sXG4gICAgaW50ZXJ2YWxzICgpOiBDYWxlbmRhclRpbWVzdGFtcFtdW10ge1xuICAgICAgY29uc3QgZGF5czogQ2FsZW5kYXJUaW1lc3RhbXBbXSA9IHRoaXMuZGF5c1xuICAgICAgY29uc3QgZmlyc3Q6IG51bWJlciA9IHRoaXMucGFyc2VkRmlyc3RJbnRlcnZhbFxuICAgICAgY29uc3QgbWludXRlczogbnVtYmVyID0gdGhpcy5wYXJzZWRJbnRlcnZhbE1pbnV0ZXNcbiAgICAgIGNvbnN0IGNvdW50OiBudW1iZXIgPSB0aGlzLnBhcnNlZEludGVydmFsQ291bnRcbiAgICAgIGNvbnN0IG5vdzogQ2FsZW5kYXJUaW1lc3RhbXAgPSB0aGlzLnRpbWVzLm5vd1xuXG4gICAgICByZXR1cm4gZGF5cy5tYXAoZCA9PiBjcmVhdGVJbnRlcnZhbExpc3QoZCwgZmlyc3QsIG1pbnV0ZXMsIGNvdW50LCBub3cpKVxuICAgIH0sXG4gICAgaW50ZXJ2YWxGb3JtYXR0ZXIgKCk6IENhbGVuZGFyRm9ybWF0dGVyIHtcbiAgICAgIGlmICh0aGlzLmludGVydmFsRm9ybWF0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmludGVydmFsRm9ybWF0IGFzIENhbGVuZGFyRm9ybWF0dGVyXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxvbmdPcHRpb25zID0geyB0aW1lWm9uZTogJ1VUQycsIGhvdXI6ICcyLWRpZ2l0JywgbWludXRlOiAnMi1kaWdpdCcgfVxuICAgICAgY29uc3Qgc2hvcnRPcHRpb25zID0geyB0aW1lWm9uZTogJ1VUQycsIGhvdXI6ICdudW1lcmljJywgbWludXRlOiAnMi1kaWdpdCcgfVxuICAgICAgY29uc3Qgc2hvcnRIb3VyT3B0aW9ucyA9IHsgdGltZVpvbmU6ICdVVEMnLCBob3VyOiAnbnVtZXJpYycgfVxuXG4gICAgICByZXR1cm4gY3JlYXRlTmF0aXZlTG9jYWxlRm9ybWF0dGVyKFxuICAgICAgICB0aGlzLmN1cnJlbnRMb2NhbGUsXG4gICAgICAgICh0bXMsIHNob3J0KSA9PiBzaG9ydCA/ICh0bXMubWludXRlID09PSAwID8gc2hvcnRIb3VyT3B0aW9ucyA6IHNob3J0T3B0aW9ucykgOiBsb25nT3B0aW9uc1xuICAgICAgKVxuICAgIH0sXG4gIH0sXG5cbiAgbWV0aG9kczoge1xuICAgIHNob3dJbnRlcnZhbExhYmVsRGVmYXVsdCAoaW50ZXJ2YWw6IENhbGVuZGFyVGltZXN0YW1wKTogYm9vbGVhbiB7XG4gICAgICBjb25zdCBmaXJzdDogQ2FsZW5kYXJUaW1lc3RhbXAgPSB0aGlzLmludGVydmFsc1swXVswXVxuICAgICAgY29uc3QgaXNGaXJzdDogYm9vbGVhbiA9IGZpcnN0LmhvdXIgPT09IGludGVydmFsLmhvdXIgJiYgZmlyc3QubWludXRlID09PSBpbnRlcnZhbC5taW51dGVcbiAgICAgIHJldHVybiAhaXNGaXJzdFxuICAgIH0sXG4gICAgaW50ZXJ2YWxTdHlsZURlZmF1bHQgKF9pbnRlcnZhbDogQ2FsZW5kYXJUaW1lc3RhbXApOiBvYmplY3QgfCB1bmRlZmluZWQge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH0sXG4gICAgZ2V0VGltZXN0YW1wQXRFdmVudCAoZTogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQsIGRheTogQ2FsZW5kYXJUaW1lc3RhbXApOiBDYWxlbmRhclRpbWVzdGFtcCB7XG4gICAgICBjb25zdCB0aW1lc3RhbXA6IENhbGVuZGFyVGltZXN0YW1wID0gY29weVRpbWVzdGFtcChkYXkpXG4gICAgICBjb25zdCBib3VuZHMgPSAoZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgICAgY29uc3QgYmFzZU1pbnV0ZXM6IG51bWJlciA9IHRoaXMuZmlyc3RNaW51dGVcbiAgICAgIGNvbnN0IHRvdWNoRXZlbnQ6IFRvdWNoRXZlbnQgPSBlIGFzIFRvdWNoRXZlbnRcbiAgICAgIGNvbnN0IG1vdXNlRXZlbnQ6IE1vdXNlRXZlbnQgPSBlIGFzIE1vdXNlRXZlbnRcbiAgICAgIGNvbnN0IHRvdWNoZXM6IFRvdWNoTGlzdCA9IHRvdWNoRXZlbnQuY2hhbmdlZFRvdWNoZXMgfHwgdG91Y2hFdmVudC50b3VjaGVzXG4gICAgICBjb25zdCBjbGllbnRZOiBudW1iZXIgPSB0b3VjaGVzICYmIHRvdWNoZXNbMF0gPyB0b3VjaGVzWzBdLmNsaWVudFkgOiBtb3VzZUV2ZW50LmNsaWVudFlcbiAgICAgIGNvbnN0IGFkZEludGVydmFsczogbnVtYmVyID0gKGNsaWVudFkgLSBib3VuZHMudG9wKSAvIHRoaXMucGFyc2VkSW50ZXJ2YWxIZWlnaHRcbiAgICAgIGNvbnN0IGFkZE1pbnV0ZXM6IG51bWJlciA9IE1hdGguZmxvb3IoYWRkSW50ZXJ2YWxzICogdGhpcy5wYXJzZWRJbnRlcnZhbE1pbnV0ZXMpXG4gICAgICBjb25zdCBtaW51dGVzOiBudW1iZXIgPSBiYXNlTWludXRlcyArIGFkZE1pbnV0ZXNcblxuICAgICAgcmV0dXJuIHVwZGF0ZU1pbnV0ZXModGltZXN0YW1wLCBtaW51dGVzLCB0aGlzLnRpbWVzLm5vdylcbiAgICB9LFxuICAgIGdldFNsb3RTY29wZSAodGltZXN0YW1wOiBDYWxlbmRhclRpbWVzdGFtcCk6IGFueSB7XG4gICAgICBjb25zdCBzY29wZSA9IGNvcHlUaW1lc3RhbXAodGltZXN0YW1wKSBhcyBhbnlcbiAgICAgIHNjb3BlLnRpbWVUb1kgPSB0aGlzLnRpbWVUb1lcbiAgICAgIHNjb3BlLm1pbnV0ZXNUb1BpeGVscyA9IHRoaXMubWludXRlc1RvUGl4ZWxzXG4gICAgICBzY29wZS53ZWVrID0gdGhpcy5kYXlzXG4gICAgICByZXR1cm4gc2NvcGVcbiAgICB9LFxuICAgIHNjcm9sbFRvVGltZSAodGltZTogVlRpbWUpOiBib29sZWFuIHtcbiAgICAgIGNvbnN0IHkgPSB0aGlzLnRpbWVUb1kodGltZSlcbiAgICAgIGNvbnN0IHBhbmUgPSB0aGlzLiRyZWZzLnNjcm9sbEFyZWEgYXMgSFRNTEVsZW1lbnRcblxuICAgICAgaWYgKHkgPT09IGZhbHNlIHx8ICFwYW5lKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICBwYW5lLnNjcm9sbFRvcCA9IHlcblxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9LFxuICAgIG1pbnV0ZXNUb1BpeGVscyAobWludXRlczogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiBtaW51dGVzIC8gdGhpcy5wYXJzZWRJbnRlcnZhbE1pbnV0ZXMgKiB0aGlzLnBhcnNlZEludGVydmFsSGVpZ2h0XG4gICAgfSxcbiAgICB0aW1lVG9ZICh0aW1lOiBWVGltZSwgY2xhbXAgPSB0cnVlKTogbnVtYmVyIHwgZmFsc2Uge1xuICAgICAgY29uc3QgbWludXRlcyA9IHBhcnNlVGltZSh0aW1lKVxuXG4gICAgICBpZiAobWludXRlcyA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1pbjogbnVtYmVyID0gdGhpcy5maXJzdE1pbnV0ZVxuICAgICAgY29uc3QgZ2FwOiBudW1iZXIgPSB0aGlzLnBhcnNlZEludGVydmFsQ291bnQgKiB0aGlzLnBhcnNlZEludGVydmFsTWludXRlc1xuICAgICAgY29uc3QgZGVsdGE6IG51bWJlciA9IChtaW51dGVzIC0gbWluKSAvIGdhcFxuICAgICAgbGV0IHk6IG51bWJlciA9IGRlbHRhICogdGhpcy5ib2R5SGVpZ2h0XG5cbiAgICAgIGlmIChjbGFtcCkge1xuICAgICAgICBpZiAoeSA8IDApIHtcbiAgICAgICAgICB5ID0gMFxuICAgICAgICB9XG4gICAgICAgIGlmICh5ID4gdGhpcy5ib2R5SGVpZ2h0KSB7XG4gICAgICAgICAgeSA9IHRoaXMuYm9keUhlaWdodFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB5XG4gICAgfSxcbiAgfSxcbn0pXG4iXX0=