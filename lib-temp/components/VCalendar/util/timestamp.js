import { isLeapYear } from '../../../util/dateTimeUtils';
export const PARSE_REGEX = /^(\d{4})-(\d{1,2})(-(\d{1,2}))?([^\d]+(\d{1,2}))?(:(\d{1,2}))?(:(\d{1,2}))?$/;
export const PARSE_TIME = /(\d\d?)(:(\d\d?)|)(:(\d\d?)|)/;
export const DAYS_IN_MONTH = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
export const DAYS_IN_MONTH_LEAP = [0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
export const DAYS_IN_MONTH_MIN = 28;
export const DAYS_IN_MONTH_MAX = 31;
export const MONTH_MAX = 12;
export const MONTH_MIN = 1;
export const DAY_MIN = 1;
export const DAYS_IN_WEEK = 7;
export const MINUTES_IN_HOUR = 60;
export const HOURS_IN_DAY = 24;
export const FIRST_HOUR = 0;
export const OFFSET_YEAR = 10000;
export const OFFSET_MONTH = 100;
export const OFFSET_HOUR = 100;
export const OFFSET_TIME = 10000;
export function getStartOfWeek(timestamp, weekdays, today) {
    const start = copyTimestamp(timestamp);
    findWeekday(start, weekdays[0], prevDay);
    updateFormatted(start);
    if (today) {
        updateRelative(start, today, start.hasTime);
    }
    return start;
}
export function getEndOfWeek(timestamp, weekdays, today) {
    const end = copyTimestamp(timestamp);
    findWeekday(end, weekdays[weekdays.length - 1]);
    updateFormatted(end);
    if (today) {
        updateRelative(end, today, end.hasTime);
    }
    return end;
}
export function getStartOfMonth(timestamp) {
    const start = copyTimestamp(timestamp);
    start.day = DAY_MIN;
    updateWeekday(start);
    updateFormatted(start);
    return start;
}
export function getEndOfMonth(timestamp) {
    const end = copyTimestamp(timestamp);
    end.day = daysInMonth(end.year, end.month);
    updateWeekday(end);
    updateFormatted(end);
    return end;
}
export function parseTime(input) {
    if (typeof input === 'number') {
        // when a number is given, it's minutes since 12:00am
        return input;
    }
    else if (typeof input === 'string') {
        // when a string is given, it's a hh:mm:ss format where seconds are optional
        const parts = PARSE_TIME.exec(input);
        if (!parts) {
            return false;
        }
        return parseInt(parts[1]) * 60 + parseInt(parts[3] || 0);
    }
    else if (typeof input === 'object') {
        // when an object is given, it must have hour and minute
        if (typeof input.hour !== 'number' || typeof input.minute !== 'number') {
            return false;
        }
        return input.hour * 60 + input.minute;
    }
    else {
        // unsupported type
        return false;
    }
}
export function validateTimestamp(input) {
    return !!PARSE_REGEX.exec(input);
}
export function parseTimestamp(input, required = false, now) {
    // YYYY-MM-DD hh:mm:ss
    const parts = PARSE_REGEX.exec(input);
    if (!parts) {
        if (required) {
            throw new Error(`${input} is not a valid timestamp. It must be in the format of YYYY-MM-DD or YYYY-MM-DD hh:mm. Zero-padding is optional and seconds are ignored.`);
        }
        return null;
    }
    const timestamp = {
        date: input,
        time: '',
        year: parseInt(parts[1]),
        month: parseInt(parts[2]),
        day: parseInt(parts[4]) || 1,
        hour: parseInt(parts[6]) || 0,
        minute: parseInt(parts[8]) || 0,
        weekday: 0,
        hasDay: !!parts[4],
        hasTime: !!(parts[6] && parts[8]),
        past: false,
        present: false,
        future: false,
    };
    updateWeekday(timestamp);
    updateFormatted(timestamp);
    if (now) {
        updateRelative(timestamp, now, timestamp.hasTime);
    }
    return timestamp;
}
export function parseDate(date) {
    return updateFormatted({
        date: '',
        time: '',
        year: date.getFullYear(),
        month: date.getMonth() + 1,
        day: date.getDate(),
        weekday: date.getDay(),
        hour: date.getHours(),
        minute: date.getMinutes(),
        hasDay: true,
        hasTime: true,
        past: false,
        present: true,
        future: false,
    });
}
export function getDayIdentifier(timestamp) {
    return timestamp.year * OFFSET_YEAR + timestamp.month * OFFSET_MONTH + timestamp.day;
}
export function getTimeIdentifier(timestamp) {
    return timestamp.hour * OFFSET_HOUR + timestamp.minute;
}
export function getTimestampIdentifier(timestamp) {
    return getDayIdentifier(timestamp) * OFFSET_TIME + getTimeIdentifier(timestamp);
}
export function updateRelative(timestamp, now, time = false) {
    let a = getDayIdentifier(now);
    let b = getDayIdentifier(timestamp);
    let present = a === b;
    if (timestamp.hasTime && time && present) {
        a = getTimeIdentifier(now);
        b = getTimeIdentifier(timestamp);
        present = a === b;
    }
    timestamp.past = b < a;
    timestamp.present = present;
    timestamp.future = b > a;
    return timestamp;
}
export function updateMinutes(timestamp, minutes, now) {
    timestamp.hasTime = true;
    timestamp.hour = Math.floor(minutes / MINUTES_IN_HOUR);
    timestamp.minute = minutes % MINUTES_IN_HOUR;
    timestamp.time = getTime(timestamp);
    if (now) {
        updateRelative(timestamp, now, true);
    }
    return timestamp;
}
export function updateWeekday(timestamp) {
    timestamp.weekday = getWeekday(timestamp);
    return timestamp;
}
export function updateFormatted(timestamp) {
    timestamp.time = getTime(timestamp);
    timestamp.date = getDate(timestamp);
    return timestamp;
}
export function getWeekday(timestamp) {
    if (timestamp.hasDay) {
        const _ = Math.floor;
        const k = timestamp.day;
        const m = ((timestamp.month + 9) % MONTH_MAX) + 1;
        const C = _(timestamp.year / 100);
        const Y = (timestamp.year % 100) - (timestamp.month <= 2 ? 1 : 0);
        return (((k + _(2.6 * m - 0.2) - 2 * C + Y + _(Y / 4) + _(C / 4)) % 7) + 7) % 7;
    }
    return timestamp.weekday;
}
export function daysInMonth(year, month) {
    return isLeapYear(year) ? DAYS_IN_MONTH_LEAP[month] : DAYS_IN_MONTH[month];
}
export function copyTimestamp(timestamp) {
    const { date, time, year, month, day, weekday, hour, minute, hasDay, hasTime, past, present, future } = timestamp;
    return { date, time, year, month, day, weekday, hour, minute, hasDay, hasTime, past, present, future };
}
export function padNumber(x, length) {
    let padded = String(x);
    while (padded.length < length) {
        padded = '0' + padded;
    }
    return padded;
}
export function getDate(timestamp) {
    let str = `${padNumber(timestamp.year, 4)}-${padNumber(timestamp.month, 2)}`;
    if (timestamp.hasDay)
        str += `-${padNumber(timestamp.day, 2)}`;
    return str;
}
export function getTime(timestamp) {
    if (!timestamp.hasTime) {
        return '';
    }
    return `${padNumber(timestamp.hour, 2)}:${padNumber(timestamp.minute, 2)}`;
}
export function nextMinutes(timestamp, minutes) {
    timestamp.minute += minutes;
    while (timestamp.minute > MINUTES_IN_HOUR) {
        timestamp.minute -= MINUTES_IN_HOUR;
        timestamp.hour++;
        if (timestamp.hour >= HOURS_IN_DAY) {
            nextDay(timestamp);
            timestamp.hour = FIRST_HOUR;
        }
    }
    return timestamp;
}
export function nextDay(timestamp) {
    timestamp.day++;
    timestamp.weekday = (timestamp.weekday + 1) % DAYS_IN_WEEK;
    if (timestamp.day > DAYS_IN_MONTH_MIN && timestamp.day > daysInMonth(timestamp.year, timestamp.month)) {
        timestamp.day = DAY_MIN;
        timestamp.month++;
        if (timestamp.month > MONTH_MAX) {
            timestamp.month = MONTH_MIN;
            timestamp.year++;
        }
    }
    return timestamp;
}
export function prevDay(timestamp) {
    timestamp.day--;
    timestamp.weekday = (timestamp.weekday + 6) % DAYS_IN_WEEK;
    if (timestamp.day < DAY_MIN) {
        timestamp.month--;
        if (timestamp.month < MONTH_MIN) {
            timestamp.year--;
            timestamp.month = MONTH_MAX;
        }
        timestamp.day = daysInMonth(timestamp.year, timestamp.month);
    }
    return timestamp;
}
export function relativeDays(timestamp, mover = nextDay, days = 1) {
    while (--days >= 0)
        mover(timestamp);
    return timestamp;
}
export function diffMinutes(min, max) {
    const Y = (max.year - min.year) * 525600;
    const M = (max.month - min.month) * 43800;
    const D = (max.day - min.day) * 1440;
    const h = (max.hour - min.hour) * 60;
    const m = (max.minute - min.minute);
    return Y + M + D + h + m;
}
export function findWeekday(timestamp, weekday, mover = nextDay, maxDays = 6) {
    while (timestamp.weekday !== weekday && --maxDays >= 0)
        mover(timestamp);
    return timestamp;
}
export function getWeekdaySkips(weekdays) {
    const skips = [1, 1, 1, 1, 1, 1, 1];
    const filled = [0, 0, 0, 0, 0, 0, 0];
    for (let i = 0; i < weekdays.length; i++) {
        filled[weekdays[i]] = 1;
    }
    for (let k = 0; k < DAYS_IN_WEEK; k++) {
        let skip = 1;
        for (let j = 1; j < DAYS_IN_WEEK; j++) {
            const next = (k + j) % DAYS_IN_WEEK;
            if (filled[next]) {
                break;
            }
            skip++;
        }
        skips[k] = filled[k] * skip;
    }
    return skips;
}
export function createDayList(start, end, now, weekdaySkips, max = 42, min = 0) {
    const stop = getDayIdentifier(end);
    const days = [];
    let current = copyTimestamp(start);
    let currentIdentifier = 0;
    let stopped = currentIdentifier === stop;
    if (stop < getDayIdentifier(start)) {
        throw new Error('End date is earlier than start date.');
    }
    while ((!stopped || days.length < min) && days.length < max) {
        currentIdentifier = getDayIdentifier(current);
        stopped = stopped || currentIdentifier === stop;
        if (weekdaySkips[current.weekday] === 0) {
            current = nextDay(current);
            continue;
        }
        const day = copyTimestamp(current);
        updateFormatted(day);
        updateRelative(day, now);
        days.push(day);
        current = relativeDays(current, nextDay, weekdaySkips[current.weekday]);
    }
    if (!days.length)
        throw new Error('No dates found using specified start date, end date, and weekdays.');
    return days;
}
export function createIntervalList(timestamp, first, minutes, count, now) {
    const intervals = [];
    for (let i = 0; i < count; i++) {
        const mins = (first + i) * minutes;
        const int = copyTimestamp(timestamp);
        intervals.push(updateMinutes(int, mins, now));
    }
    return intervals;
}
export function createNativeLocaleFormatter(locale, getOptions) {
    const emptyFormatter = (_t, _s) => '';
    if (typeof Intl === 'undefined' || typeof Intl.DateTimeFormat === 'undefined') {
        return emptyFormatter;
    }
    return (timestamp, short) => {
        try {
            const intlFormatter = new Intl.DateTimeFormat(locale || undefined, getOptions(timestamp, short));
            const time = `${padNumber(timestamp.hour, 2)}:${padNumber(timestamp.minute, 2)}`;
            const date = timestamp.date;
            return intlFormatter.format(new Date(`${date}T${time}:00+00:00`));
        }
        catch (e) {
            return '';
        }
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXN0YW1wLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVkNhbGVuZGFyL3V0aWwvdGltZXN0YW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUV4RCxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQVcsOEVBQThFLENBQUE7QUFDakgsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFXLCtCQUErQixDQUFBO0FBRWpFLE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBYSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFBO0FBQzFGLE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFhLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDL0YsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsRUFBRSxDQUFBO0FBQ25DLE1BQU0sQ0FBQyxNQUFNLGlCQUFpQixHQUFHLEVBQUUsQ0FBQTtBQUNuQyxNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFBO0FBQzNCLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxDQUFDLENBQUE7QUFDMUIsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFHLENBQUMsQ0FBQTtBQUN4QixNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFBO0FBQzdCLE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxFQUFF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UyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUE7WUFDaEcsTUFBTSxJQUFJLEdBQUcsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxTQUFTLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFBO1lBQ2hGLE1BQU0sSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUE7WUFFM0IsT0FBTyxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQTtTQUNsRTtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxFQUFFLENBQUE7U0FDVjtJQUNILENBQUMsQ0FBQTtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDYWxlbmRhclRpbWVzdGFtcCwgQ2FsZW5kYXJGb3JtYXR0ZXIgfSBmcm9tICd0eXBlcydcbmltcG9ydCB7IGlzTGVhcFllYXIgfSBmcm9tICcuLi8uLi8uLi91dGlsL2RhdGVUaW1lVXRpbHMnXG5cbmV4cG9ydCBjb25zdCBQQVJTRV9SRUdFWDogUmVnRXhwID0gL14oXFxkezR9KS0oXFxkezEsMn0pKC0oXFxkezEsMn0pKT8oW15cXGRdKyhcXGR7MSwyfSkpPyg6KFxcZHsxLDJ9KSk/KDooXFxkezEsMn0pKT8kL1xuZXhwb3J0IGNvbnN0IFBBUlNFX1RJTUU6IFJlZ0V4cCA9IC8oXFxkXFxkPykoOihcXGRcXGQ/KXwpKDooXFxkXFxkPyl8KS9cblxuZXhwb3J0IGNvbnN0IERBWVNfSU5fTU9OVEg6IG51bWJlcltdID0gWzAsIDMxLCAyOCwgMzEsIDMwLCAzMSwgMzAsIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzFdXG5leHBvcnQgY29uc3QgREFZU19JTl9NT05USF9MRUFQOiBudW1iZXJbXSA9IFswLCAzMSwgMjksIDMxLCAzMCwgMzEsIDMwLCAzMSwgMzEsIDMwLCAzMSwgMzAsIDMxXVxuZXhwb3J0IGNvbnN0IERBWVNfSU5fTU9OVEhfTUlOID0gMjhcbmV4cG9ydCBjb25zdCBEQVlTX0lOX01PTlRIX01BWCA9IDMxXG5leHBvcnQgY29uc3QgTU9OVEhfTUFYID0gMTJcbmV4cG9ydCBjb25zdCBNT05USF9NSU4gPSAxXG5leHBvcnQgY29uc3QgREFZX01JTiA9IDFcbmV4cG9ydCBjb25zdCBEQVlTX0lOX1dFRUsgPSA3XG5leHBvcnQgY29uc3QgTUlOVVRFU19JTl9IT1VSID0gNjBcbmV4cG9ydCBjb25zdCBIT1VSU19JTl9EQVkgPSAyNFxuZXhwb3J0IGNvbnN0IEZJUlNUX0hPVVIgPSAwXG5leHBvcnQgY29uc3QgT0ZGU0VUX1lFQVIgPSAxMDAwMFxuZXhwb3J0IGNvbnN0IE9GRlNFVF9NT05USCA9IDEwMFxuZXhwb3J0IGNvbnN0IE9GRlNFVF9IT1VSID0gMTAwXG5leHBvcnQgY29uc3QgT0ZGU0VUX1RJTUUgPSAxMDAwMFxuXG50eXBlIENhbGVuZGFyVGltZXN0YW1wRm9ybWF0T3B0aW9ucyA9ICh0aW1lc3RhbXA6IENhbGVuZGFyVGltZXN0YW1wLCBzaG9ydDogYm9vbGVhbikgPT4gb2JqZWN0XG50eXBlIENhbGVuZGFyVGltZXN0YW1wT3BlcmF0aW9uID0gKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXApID0+IENhbGVuZGFyVGltZXN0YW1wXG5leHBvcnQgdHlwZSBWVGltZSA9IG51bWJlciB8IHN0cmluZyB8IHtcbiAgaG91cjogbnVtYmVyXG4gIG1pbnV0ZTogbnVtYmVyXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTdGFydE9mV2VlayAodGltZXN0YW1wOiBDYWxlbmRhclRpbWVzdGFtcCwgd2Vla2RheXM6IG51bWJlcltdLCB0b2RheT86IENhbGVuZGFyVGltZXN0YW1wKTogQ2FsZW5kYXJUaW1lc3RhbXAge1xuICBjb25zdCBzdGFydCA9IGNvcHlUaW1lc3RhbXAodGltZXN0YW1wKVxuICBmaW5kV2Vla2RheShzdGFydCwgd2Vla2RheXNbMF0sIHByZXZEYXkpXG4gIHVwZGF0ZUZvcm1hdHRlZChzdGFydClcbiAgaWYgKHRvZGF5KSB7XG4gICAgdXBkYXRlUmVsYXRpdmUoc3RhcnQsIHRvZGF5LCBzdGFydC5oYXNUaW1lKVxuICB9XG5cbiAgcmV0dXJuIHN0YXJ0XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFbmRPZldlZWsgKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXAsIHdlZWtkYXlzOiBudW1iZXJbXSwgdG9kYXk/OiBDYWxlbmRhclRpbWVzdGFtcCk6IENhbGVuZGFyVGltZXN0YW1wIHtcbiAgY29uc3QgZW5kID0gY29weVRpbWVzdGFtcCh0aW1lc3RhbXApXG4gIGZpbmRXZWVrZGF5KGVuZCwgd2Vla2RheXNbd2Vla2RheXMubGVuZ3RoIC0gMV0pXG4gIHVwZGF0ZUZvcm1hdHRlZChlbmQpXG4gIGlmICh0b2RheSkge1xuICAgIHVwZGF0ZVJlbGF0aXZlKGVuZCwgdG9kYXksIGVuZC5oYXNUaW1lKVxuICB9XG5cbiAgcmV0dXJuIGVuZFxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RhcnRPZk1vbnRoICh0aW1lc3RhbXA6IENhbGVuZGFyVGltZXN0YW1wKTogQ2FsZW5kYXJUaW1lc3RhbXAge1xuICBjb25zdCBzdGFydCA9IGNvcHlUaW1lc3RhbXAodGltZXN0YW1wKVxuICBzdGFydC5kYXkgPSBEQVlfTUlOXG4gIHVwZGF0ZVdlZWtkYXkoc3RhcnQpXG4gIHVwZGF0ZUZvcm1hdHRlZChzdGFydClcblxuICByZXR1cm4gc3RhcnRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEVuZE9mTW9udGggKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXApOiBDYWxlbmRhclRpbWVzdGFtcCB7XG4gIGNvbnN0IGVuZCA9IGNvcHlUaW1lc3RhbXAodGltZXN0YW1wKVxuICBlbmQuZGF5ID0gZGF5c0luTW9udGgoZW5kLnllYXIsIGVuZC5tb250aClcbiAgdXBkYXRlV2Vla2RheShlbmQpXG4gIHVwZGF0ZUZvcm1hdHRlZChlbmQpXG5cbiAgcmV0dXJuIGVuZFxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VUaW1lIChpbnB1dDogYW55KTogbnVtYmVyIHwgZmFsc2Uge1xuICBpZiAodHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJykge1xuICAgIC8vIHdoZW4gYSBudW1iZXIgaXMgZ2l2ZW4sIGl0J3MgbWludXRlcyBzaW5jZSAxMjowMGFtXG4gICAgcmV0dXJuIGlucHV0XG4gIH0gZWxzZSBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykge1xuICAgIC8vIHdoZW4gYSBzdHJpbmcgaXMgZ2l2ZW4sIGl0J3MgYSBoaDptbTpzcyBmb3JtYXQgd2hlcmUgc2Vjb25kcyBhcmUgb3B0aW9uYWxcbiAgICBjb25zdCBwYXJ0cyA9IFBBUlNFX1RJTUUuZXhlYyhpbnB1dClcbiAgICBpZiAoIXBhcnRzKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICByZXR1cm4gcGFyc2VJbnQocGFydHNbMV0pICogNjAgKyBwYXJzZUludChwYXJ0c1szXSB8fCAwKVxuICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ29iamVjdCcpIHtcbiAgICAvLyB3aGVuIGFuIG9iamVjdCBpcyBnaXZlbiwgaXQgbXVzdCBoYXZlIGhvdXIgYW5kIG1pbnV0ZVxuICAgIGlmICh0eXBlb2YgaW5wdXQuaG91ciAhPT0gJ251bWJlcicgfHwgdHlwZW9mIGlucHV0Lm1pbnV0ZSAhPT0gJ251bWJlcicpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHJldHVybiBpbnB1dC5ob3VyICogNjAgKyBpbnB1dC5taW51dGVcbiAgfSBlbHNlIHtcbiAgICAvLyB1bnN1cHBvcnRlZCB0eXBlXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlVGltZXN0YW1wIChpbnB1dDogYW55KTogYm9vbGVhbiB7XG4gIHJldHVybiAhIVBBUlNFX1JFR0VYLmV4ZWMoaW5wdXQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVRpbWVzdGFtcCAoaW5wdXQ6IHN0cmluZywgcmVxdWlyZWQ/OiBmYWxzZSwgbm93PzogQ2FsZW5kYXJUaW1lc3RhbXApOiBDYWxlbmRhclRpbWVzdGFtcCB8IG51bGxcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVRpbWVzdGFtcCAoaW5wdXQ6IHN0cmluZywgcmVxdWlyZWQ6IHRydWUsIG5vdz86IENhbGVuZGFyVGltZXN0YW1wKTogQ2FsZW5kYXJUaW1lc3RhbXBcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVRpbWVzdGFtcCAoaW5wdXQ6IHN0cmluZywgcmVxdWlyZWQgPSBmYWxzZSwgbm93PzogQ2FsZW5kYXJUaW1lc3RhbXApOiBDYWxlbmRhclRpbWVzdGFtcCB8IG51bGwge1xuICAvLyBZWVlZLU1NLUREIGhoOm1tOnNzXG4gIGNvbnN0IHBhcnRzID0gUEFSU0VfUkVHRVguZXhlYyhpbnB1dClcblxuICBpZiAoIXBhcnRzKSB7XG4gICAgaWYgKHJlcXVpcmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7aW5wdXR9IGlzIG5vdCBhIHZhbGlkIHRpbWVzdGFtcC4gSXQgbXVzdCBiZSBpbiB0aGUgZm9ybWF0IG9mIFlZWVktTU0tREQgb3IgWVlZWS1NTS1ERCBoaDptbS4gWmVyby1wYWRkaW5nIGlzIG9wdGlvbmFsIGFuZCBzZWNvbmRzIGFyZSBpZ25vcmVkLmApXG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIGNvbnN0IHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXAgPSB7XG4gICAgZGF0ZTogaW5wdXQsXG4gICAgdGltZTogJycsXG4gICAgeWVhcjogcGFyc2VJbnQocGFydHNbMV0pLFxuICAgIG1vbnRoOiBwYXJzZUludChwYXJ0c1syXSksXG4gICAgZGF5OiBwYXJzZUludChwYXJ0c1s0XSkgfHwgMSxcbiAgICBob3VyOiBwYXJzZUludChwYXJ0c1s2XSkgfHwgMCxcbiAgICBtaW51dGU6IHBhcnNlSW50KHBhcnRzWzhdKSB8fCAwLFxuICAgIHdlZWtkYXk6IDAsXG4gICAgaGFzRGF5OiAhIXBhcnRzWzRdLFxuICAgIGhhc1RpbWU6ICEhKHBhcnRzWzZdICYmIHBhcnRzWzhdKSxcbiAgICBwYXN0OiBmYWxzZSxcbiAgICBwcmVzZW50OiBmYWxzZSxcbiAgICBmdXR1cmU6IGZhbHNlLFxuICB9XG5cbiAgdXBkYXRlV2Vla2RheSh0aW1lc3RhbXApXG4gIHVwZGF0ZUZvcm1hdHRlZCh0aW1lc3RhbXApXG5cbiAgaWYgKG5vdykge1xuICAgIHVwZGF0ZVJlbGF0aXZlKHRpbWVzdGFtcCwgbm93LCB0aW1lc3RhbXAuaGFzVGltZSlcbiAgfVxuXG4gIHJldHVybiB0aW1lc3RhbXBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRGF0ZSAoZGF0ZTogRGF0ZSk6IENhbGVuZGFyVGltZXN0YW1wIHtcbiAgcmV0dXJuIHVwZGF0ZUZvcm1hdHRlZCh7XG4gICAgZGF0ZTogJycsXG4gICAgdGltZTogJycsXG4gICAgeWVhcjogZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgIG1vbnRoOiBkYXRlLmdldE1vbnRoKCkgKyAxLFxuICAgIGRheTogZGF0ZS5nZXREYXRlKCksXG4gICAgd2Vla2RheTogZGF0ZS5nZXREYXkoKSxcbiAgICBob3VyOiBkYXRlLmdldEhvdXJzKCksXG4gICAgbWludXRlOiBkYXRlLmdldE1pbnV0ZXMoKSxcbiAgICBoYXNEYXk6IHRydWUsXG4gICAgaGFzVGltZTogdHJ1ZSxcbiAgICBwYXN0OiBmYWxzZSxcbiAgICBwcmVzZW50OiB0cnVlLFxuICAgIGZ1dHVyZTogZmFsc2UsXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREYXlJZGVudGlmaWVyICh0aW1lc3RhbXA6IHsgeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyLCBkYXk6IG51bWJlciB9KTogbnVtYmVyIHtcbiAgcmV0dXJuIHRpbWVzdGFtcC55ZWFyICogT0ZGU0VUX1lFQVIgKyB0aW1lc3RhbXAubW9udGggKiBPRkZTRVRfTU9OVEggKyB0aW1lc3RhbXAuZGF5XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRUaW1lSWRlbnRpZmllciAodGltZXN0YW1wOiB7IGhvdXI6IG51bWJlciwgbWludXRlOiBudW1iZXIgfSk6IG51bWJlciB7XG4gIHJldHVybiB0aW1lc3RhbXAuaG91ciAqIE9GRlNFVF9IT1VSICsgdGltZXN0YW1wLm1pbnV0ZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGltZXN0YW1wSWRlbnRpZmllciAodGltZXN0YW1wOiBDYWxlbmRhclRpbWVzdGFtcCk6IG51bWJlciB7XG4gIHJldHVybiBnZXREYXlJZGVudGlmaWVyKHRpbWVzdGFtcCkgKiBPRkZTRVRfVElNRSArIGdldFRpbWVJZGVudGlmaWVyKHRpbWVzdGFtcClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlbGF0aXZlICh0aW1lc3RhbXA6IENhbGVuZGFyVGltZXN0YW1wLCBub3c6IENhbGVuZGFyVGltZXN0YW1wLCB0aW1lID0gZmFsc2UpOiBDYWxlbmRhclRpbWVzdGFtcCB7XG4gIGxldCBhID0gZ2V0RGF5SWRlbnRpZmllcihub3cpXG4gIGxldCBiID0gZ2V0RGF5SWRlbnRpZmllcih0aW1lc3RhbXApXG4gIGxldCBwcmVzZW50ID0gYSA9PT0gYlxuXG4gIGlmICh0aW1lc3RhbXAuaGFzVGltZSAmJiB0aW1lICYmIHByZXNlbnQpIHtcbiAgICBhID0gZ2V0VGltZUlkZW50aWZpZXIobm93KVxuICAgIGIgPSBnZXRUaW1lSWRlbnRpZmllcih0aW1lc3RhbXApXG4gICAgcHJlc2VudCA9IGEgPT09IGJcbiAgfVxuXG4gIHRpbWVzdGFtcC5wYXN0ID0gYiA8IGFcbiAgdGltZXN0YW1wLnByZXNlbnQgPSBwcmVzZW50XG4gIHRpbWVzdGFtcC5mdXR1cmUgPSBiID4gYVxuXG4gIHJldHVybiB0aW1lc3RhbXBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZU1pbnV0ZXMgKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXAsIG1pbnV0ZXM6IG51bWJlciwgbm93PzogQ2FsZW5kYXJUaW1lc3RhbXApOiBDYWxlbmRhclRpbWVzdGFtcCB7XG4gIHRpbWVzdGFtcC5oYXNUaW1lID0gdHJ1ZVxuICB0aW1lc3RhbXAuaG91ciA9IE1hdGguZmxvb3IobWludXRlcyAvIE1JTlVURVNfSU5fSE9VUilcbiAgdGltZXN0YW1wLm1pbnV0ZSA9IG1pbnV0ZXMgJSBNSU5VVEVTX0lOX0hPVVJcbiAgdGltZXN0YW1wLnRpbWUgPSBnZXRUaW1lKHRpbWVzdGFtcClcbiAgaWYgKG5vdykge1xuICAgIHVwZGF0ZVJlbGF0aXZlKHRpbWVzdGFtcCwgbm93LCB0cnVlKVxuICB9XG5cbiAgcmV0dXJuIHRpbWVzdGFtcFxufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlV2Vla2RheSAodGltZXN0YW1wOiBDYWxlbmRhclRpbWVzdGFtcCk6IENhbGVuZGFyVGltZXN0YW1wIHtcbiAgdGltZXN0YW1wLndlZWtkYXkgPSBnZXRXZWVrZGF5KHRpbWVzdGFtcClcblxuICByZXR1cm4gdGltZXN0YW1wXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVGb3JtYXR0ZWQgKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXApOiBDYWxlbmRhclRpbWVzdGFtcCB7XG4gIHRpbWVzdGFtcC50aW1lID0gZ2V0VGltZSh0aW1lc3RhbXApXG4gIHRpbWVzdGFtcC5kYXRlID0gZ2V0RGF0ZSh0aW1lc3RhbXApXG5cbiAgcmV0dXJuIHRpbWVzdGFtcFxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0V2Vla2RheSAodGltZXN0YW1wOiBDYWxlbmRhclRpbWVzdGFtcCk6IG51bWJlciB7XG4gIGlmICh0aW1lc3RhbXAuaGFzRGF5KSB7XG4gICAgY29uc3QgXyA9IE1hdGguZmxvb3JcbiAgICBjb25zdCBrID0gdGltZXN0YW1wLmRheVxuICAgIGNvbnN0IG0gPSAoKHRpbWVzdGFtcC5tb250aCArIDkpICUgTU9OVEhfTUFYKSArIDFcbiAgICBjb25zdCBDID0gXyh0aW1lc3RhbXAueWVhciAvIDEwMClcbiAgICBjb25zdCBZID0gKHRpbWVzdGFtcC55ZWFyICUgMTAwKSAtICh0aW1lc3RhbXAubW9udGggPD0gMiA/IDEgOiAwKVxuXG4gICAgcmV0dXJuICgoKGsgKyBfKDIuNiAqIG0gLSAwLjIpIC0gMiAqIEMgKyBZICsgXyhZIC8gNCkgKyBfKEMgLyA0KSkgJSA3KSArIDcpICUgN1xuICB9XG5cbiAgcmV0dXJuIHRpbWVzdGFtcC53ZWVrZGF5XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkYXlzSW5Nb250aCAoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XG4gIHJldHVybiBpc0xlYXBZZWFyKHllYXIpID8gREFZU19JTl9NT05USF9MRUFQW21vbnRoXSA6IERBWVNfSU5fTU9OVEhbbW9udGhdXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb3B5VGltZXN0YW1wICh0aW1lc3RhbXA6IENhbGVuZGFyVGltZXN0YW1wKTogQ2FsZW5kYXJUaW1lc3RhbXAge1xuICBjb25zdCB7IGRhdGUsIHRpbWUsIHllYXIsIG1vbnRoLCBkYXksIHdlZWtkYXksIGhvdXIsIG1pbnV0ZSwgaGFzRGF5LCBoYXNUaW1lLCBwYXN0LCBwcmVzZW50LCBmdXR1cmUgfSA9IHRpbWVzdGFtcFxuXG4gIHJldHVybiB7IGRhdGUsIHRpbWUsIHllYXIsIG1vbnRoLCBkYXksIHdlZWtkYXksIGhvdXIsIG1pbnV0ZSwgaGFzRGF5LCBoYXNUaW1lLCBwYXN0LCBwcmVzZW50LCBmdXR1cmUgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFkTnVtYmVyICh4OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgbGV0IHBhZGRlZCA9IFN0cmluZyh4KVxuICB3aGlsZSAocGFkZGVkLmxlbmd0aCA8IGxlbmd0aCkge1xuICAgIHBhZGRlZCA9ICcwJyArIHBhZGRlZFxuICB9XG5cbiAgcmV0dXJuIHBhZGRlZFxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGF0ZSAodGltZXN0YW1wOiBDYWxlbmRhclRpbWVzdGFtcCk6IHN0cmluZyB7XG4gIGxldCBzdHIgPSBgJHtwYWROdW1iZXIodGltZXN0YW1wLnllYXIsIDQpfS0ke3BhZE51bWJlcih0aW1lc3RhbXAubW9udGgsIDIpfWBcblxuICBpZiAodGltZXN0YW1wLmhhc0RheSkgc3RyICs9IGAtJHtwYWROdW1iZXIodGltZXN0YW1wLmRheSwgMil9YFxuXG4gIHJldHVybiBzdHJcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWUgKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXApOiBzdHJpbmcge1xuICBpZiAoIXRpbWVzdGFtcC5oYXNUaW1lKSB7XG4gICAgcmV0dXJuICcnXG4gIH1cblxuICByZXR1cm4gYCR7cGFkTnVtYmVyKHRpbWVzdGFtcC5ob3VyLCAyKX06JHtwYWROdW1iZXIodGltZXN0YW1wLm1pbnV0ZSwgMil9YFxufVxuXG5leHBvcnQgZnVuY3Rpb24gbmV4dE1pbnV0ZXMgKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXAsIG1pbnV0ZXM6IG51bWJlcik6IENhbGVuZGFyVGltZXN0YW1wIHtcbiAgdGltZXN0YW1wLm1pbnV0ZSArPSBtaW51dGVzXG4gIHdoaWxlICh0aW1lc3RhbXAubWludXRlID4gTUlOVVRFU19JTl9IT1VSKSB7XG4gICAgdGltZXN0YW1wLm1pbnV0ZSAtPSBNSU5VVEVTX0lOX0hPVVJcbiAgICB0aW1lc3RhbXAuaG91cisrXG4gICAgaWYgKHRpbWVzdGFtcC5ob3VyID49IEhPVVJTX0lOX0RBWSkge1xuICAgICAgbmV4dERheSh0aW1lc3RhbXApXG4gICAgICB0aW1lc3RhbXAuaG91ciA9IEZJUlNUX0hPVVJcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGltZXN0YW1wXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBuZXh0RGF5ICh0aW1lc3RhbXA6IENhbGVuZGFyVGltZXN0YW1wKTogQ2FsZW5kYXJUaW1lc3RhbXAge1xuICB0aW1lc3RhbXAuZGF5KytcbiAgdGltZXN0YW1wLndlZWtkYXkgPSAodGltZXN0YW1wLndlZWtkYXkgKyAxKSAlIERBWVNfSU5fV0VFS1xuICBpZiAodGltZXN0YW1wLmRheSA+IERBWVNfSU5fTU9OVEhfTUlOICYmIHRpbWVzdGFtcC5kYXkgPiBkYXlzSW5Nb250aCh0aW1lc3RhbXAueWVhciwgdGltZXN0YW1wLm1vbnRoKSkge1xuICAgIHRpbWVzdGFtcC5kYXkgPSBEQVlfTUlOXG4gICAgdGltZXN0YW1wLm1vbnRoKytcbiAgICBpZiAodGltZXN0YW1wLm1vbnRoID4gTU9OVEhfTUFYKSB7XG4gICAgICB0aW1lc3RhbXAubW9udGggPSBNT05USF9NSU5cbiAgICAgIHRpbWVzdGFtcC55ZWFyKytcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGltZXN0YW1wXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcmV2RGF5ICh0aW1lc3RhbXA6IENhbGVuZGFyVGltZXN0YW1wKTogQ2FsZW5kYXJUaW1lc3RhbXAge1xuICB0aW1lc3RhbXAuZGF5LS1cbiAgdGltZXN0YW1wLndlZWtkYXkgPSAodGltZXN0YW1wLndlZWtkYXkgKyA2KSAlIERBWVNfSU5fV0VFS1xuICBpZiAodGltZXN0YW1wLmRheSA8IERBWV9NSU4pIHtcbiAgICB0aW1lc3RhbXAubW9udGgtLVxuICAgIGlmICh0aW1lc3RhbXAubW9udGggPCBNT05USF9NSU4pIHtcbiAgICAgIHRpbWVzdGFtcC55ZWFyLS1cbiAgICAgIHRpbWVzdGFtcC5tb250aCA9IE1PTlRIX01BWFxuICAgIH1cbiAgICB0aW1lc3RhbXAuZGF5ID0gZGF5c0luTW9udGgodGltZXN0YW1wLnllYXIsIHRpbWVzdGFtcC5tb250aClcbiAgfVxuXG4gIHJldHVybiB0aW1lc3RhbXBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbGF0aXZlRGF5cyAoXG4gIHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXAsXG4gIG1vdmVyOiBDYWxlbmRhclRpbWVzdGFtcE9wZXJhdGlvbiA9IG5leHREYXksXG4gIGRheXMgPSAxXG4pOiBDYWxlbmRhclRpbWVzdGFtcCB7XG4gIHdoaWxlICgtLWRheXMgPj0gMCkgbW92ZXIodGltZXN0YW1wKVxuXG4gIHJldHVybiB0aW1lc3RhbXBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRpZmZNaW51dGVzIChtaW46IENhbGVuZGFyVGltZXN0YW1wLCBtYXg6IENhbGVuZGFyVGltZXN0YW1wKSB7XG4gIGNvbnN0IFkgPSAobWF4LnllYXIgLSBtaW4ueWVhcikgKiA1MjU2MDBcbiAgY29uc3QgTSA9IChtYXgubW9udGggLSBtaW4ubW9udGgpICogNDM4MDBcbiAgY29uc3QgRCA9IChtYXguZGF5IC0gbWluLmRheSkgKiAxNDQwXG4gIGNvbnN0IGggPSAobWF4LmhvdXIgLSBtaW4uaG91cikgKiA2MFxuICBjb25zdCBtID0gKG1heC5taW51dGUgLSBtaW4ubWludXRlKVxuXG4gIHJldHVybiBZICsgTSArIEQgKyBoICsgbVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFdlZWtkYXkgKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXAsIHdlZWtkYXk6IG51bWJlcixcbiAgbW92ZXI6IENhbGVuZGFyVGltZXN0YW1wT3BlcmF0aW9uID0gbmV4dERheSwgbWF4RGF5cyA9IDYpOiBDYWxlbmRhclRpbWVzdGFtcCB7XG4gIHdoaWxlICh0aW1lc3RhbXAud2Vla2RheSAhPT0gd2Vla2RheSAmJiAtLW1heERheXMgPj0gMCkgbW92ZXIodGltZXN0YW1wKVxuXG4gIHJldHVybiB0aW1lc3RhbXBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFdlZWtkYXlTa2lwcyAod2Vla2RheXM6IG51bWJlcltdKTogbnVtYmVyW10ge1xuICBjb25zdCBza2lwczogbnVtYmVyW10gPSBbMSwgMSwgMSwgMSwgMSwgMSwgMV1cbiAgY29uc3QgZmlsbGVkOiBudW1iZXJbXSA9IFswLCAwLCAwLCAwLCAwLCAwLCAwXVxuICBmb3IgKGxldCBpID0gMDsgaSA8IHdlZWtkYXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgZmlsbGVkW3dlZWtkYXlzW2ldXSA9IDFcbiAgfVxuICBmb3IgKGxldCBrID0gMDsgayA8IERBWVNfSU5fV0VFSzsgaysrKSB7XG4gICAgbGV0IHNraXAgPSAxXG4gICAgZm9yIChsZXQgaiA9IDE7IGogPCBEQVlTX0lOX1dFRUs7IGorKykge1xuICAgICAgY29uc3QgbmV4dCA9IChrICsgaikgJSBEQVlTX0lOX1dFRUtcbiAgICAgIGlmIChmaWxsZWRbbmV4dF0pIHtcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICAgIHNraXArK1xuICAgIH1cbiAgICBza2lwc1trXSA9IGZpbGxlZFtrXSAqIHNraXBcbiAgfVxuXG4gIHJldHVybiBza2lwc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGF5TGlzdCAoXG4gIHN0YXJ0OiBDYWxlbmRhclRpbWVzdGFtcCxcbiAgZW5kOiBDYWxlbmRhclRpbWVzdGFtcCxcbiAgbm93OiBDYWxlbmRhclRpbWVzdGFtcCxcbiAgd2Vla2RheVNraXBzOiBudW1iZXJbXSxcbiAgbWF4ID0gNDIsXG4gIG1pbiA9IDBcbik6IENhbGVuZGFyVGltZXN0YW1wW10ge1xuICBjb25zdCBzdG9wID0gZ2V0RGF5SWRlbnRpZmllcihlbmQpXG4gIGNvbnN0IGRheXM6IENhbGVuZGFyVGltZXN0YW1wW10gPSBbXVxuICBsZXQgY3VycmVudCA9IGNvcHlUaW1lc3RhbXAoc3RhcnQpXG4gIGxldCBjdXJyZW50SWRlbnRpZmllciA9IDBcbiAgbGV0IHN0b3BwZWQgPSBjdXJyZW50SWRlbnRpZmllciA9PT0gc3RvcFxuXG4gIGlmIChzdG9wIDwgZ2V0RGF5SWRlbnRpZmllcihzdGFydCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0VuZCBkYXRlIGlzIGVhcmxpZXIgdGhhbiBzdGFydCBkYXRlLicpXG4gIH1cblxuICB3aGlsZSAoKCFzdG9wcGVkIHx8IGRheXMubGVuZ3RoIDwgbWluKSAmJiBkYXlzLmxlbmd0aCA8IG1heCkge1xuICAgIGN1cnJlbnRJZGVudGlmaWVyID0gZ2V0RGF5SWRlbnRpZmllcihjdXJyZW50KVxuICAgIHN0b3BwZWQgPSBzdG9wcGVkIHx8IGN1cnJlbnRJZGVudGlmaWVyID09PSBzdG9wXG4gICAgaWYgKHdlZWtkYXlTa2lwc1tjdXJyZW50LndlZWtkYXldID09PSAwKSB7XG4gICAgICBjdXJyZW50ID0gbmV4dERheShjdXJyZW50KVxuICAgICAgY29udGludWVcbiAgICB9XG4gICAgY29uc3QgZGF5ID0gY29weVRpbWVzdGFtcChjdXJyZW50KVxuICAgIHVwZGF0ZUZvcm1hdHRlZChkYXkpXG4gICAgdXBkYXRlUmVsYXRpdmUoZGF5LCBub3cpXG4gICAgZGF5cy5wdXNoKGRheSlcbiAgICBjdXJyZW50ID0gcmVsYXRpdmVEYXlzKGN1cnJlbnQsIG5leHREYXksIHdlZWtkYXlTa2lwc1tjdXJyZW50LndlZWtkYXldKVxuICB9XG5cbiAgaWYgKCFkYXlzLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCdObyBkYXRlcyBmb3VuZCB1c2luZyBzcGVjaWZpZWQgc3RhcnQgZGF0ZSwgZW5kIGRhdGUsIGFuZCB3ZWVrZGF5cy4nKVxuXG4gIHJldHVybiBkYXlzXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbnRlcnZhbExpc3QgKHRpbWVzdGFtcDogQ2FsZW5kYXJUaW1lc3RhbXAsIGZpcnN0OiBudW1iZXIsXG4gIG1pbnV0ZXM6IG51bWJlciwgY291bnQ6IG51bWJlciwgbm93PzogQ2FsZW5kYXJUaW1lc3RhbXApOiBDYWxlbmRhclRpbWVzdGFtcFtdIHtcbiAgY29uc3QgaW50ZXJ2YWxzOiBDYWxlbmRhclRpbWVzdGFtcFtdID0gW11cblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICBjb25zdCBtaW5zID0gKGZpcnN0ICsgaSkgKiBtaW51dGVzXG4gICAgY29uc3QgaW50ID0gY29weVRpbWVzdGFtcCh0aW1lc3RhbXApXG4gICAgaW50ZXJ2YWxzLnB1c2godXBkYXRlTWludXRlcyhpbnQsIG1pbnMsIG5vdykpXG4gIH1cblxuICByZXR1cm4gaW50ZXJ2YWxzXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVOYXRpdmVMb2NhbGVGb3JtYXR0ZXIgKGxvY2FsZTogc3RyaW5nLCBnZXRPcHRpb25zOiBDYWxlbmRhclRpbWVzdGFtcEZvcm1hdE9wdGlvbnMpOiBDYWxlbmRhckZvcm1hdHRlciB7XG4gIGNvbnN0IGVtcHR5Rm9ybWF0dGVyOiBDYWxlbmRhckZvcm1hdHRlciA9IChfdCwgX3MpID0+ICcnXG5cbiAgaWYgKHR5cGVvZiBJbnRsID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgSW50bC5EYXRlVGltZUZvcm1hdCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gZW1wdHlGb3JtYXR0ZXJcbiAgfVxuXG4gIHJldHVybiAodGltZXN0YW1wLCBzaG9ydCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBpbnRsRm9ybWF0dGVyID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlIHx8IHVuZGVmaW5lZCwgZ2V0T3B0aW9ucyh0aW1lc3RhbXAsIHNob3J0KSlcbiAgICAgIGNvbnN0IHRpbWUgPSBgJHtwYWROdW1iZXIodGltZXN0YW1wLmhvdXIsIDIpfToke3BhZE51bWJlcih0aW1lc3RhbXAubWludXRlLCAyKX1gXG4gICAgICBjb25zdCBkYXRlID0gdGltZXN0YW1wLmRhdGVcblxuICAgICAgcmV0dXJuIGludGxGb3JtYXR0ZXIuZm9ybWF0KG5ldyBEYXRlKGAke2RhdGV9VCR7dGltZX06MDArMDA6MDBgKSlcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gJydcbiAgICB9XG4gIH1cbn1cbiJdfQ==