// Mixins
import DatePickerTable from './mixins/date-picker-table';
// Utils
import { weekNumber } from '../../util/dateTimeUtils';
import { pad, createNativeLocaleFormatter, monthChange } from './util';
import { createRange } from '../../util/helpers';
import mixins from '../../util/mixins';
export default mixins(DatePickerTable
/* @vue/component */
).extend({
    name: 'v-date-picker-date-table',
    props: {
        firstDayOfWeek: {
            type: [String, Number],
            default: 0,
        },
        localeFirstDayOfYear: {
            type: [String, Number],
            default: 0,
        },
        showWeek: Boolean,
        weekdayFormat: Function,
    },
    computed: {
        formatter() {
            return this.format || createNativeLocaleFormatter(this.currentLocale, { day: 'numeric', timeZone: 'UTC' }, { start: 8, length: 2 });
        },
        weekdayFormatter() {
            return this.weekdayFormat || createNativeLocaleFormatter(this.currentLocale, { weekday: 'narrow', timeZone: 'UTC' });
        },
        weekDays() {
            const first = parseInt(this.firstDayOfWeek, 10);
            return this.weekdayFormatter
                ? createRange(7).map(i => this.weekdayFormatter(`2017-01-${first + i + 15}`)) // 2017-01-15 is Sunday
                : createRange(7).map(i => ['S', 'M', 'T', 'W', 'T', 'F', 'S'][(i + first) % 7]);
        },
    },
    methods: {
        calculateTableDate(delta) {
            return monthChange(this.tableDate, Math.sign(delta || 1));
        },
        genTHead() {
            const days = this.weekDays.map(day => this.$createElement('th', day));
            if (this.showWeek) {
                days.unshift(this.$createElement('th'));
            }
            return this.$createElement('thead', this.genTR(days));
        },
        // Returns number of the days from the firstDayOfWeek to the first day of the current month
        weekDaysBeforeFirstDayOfTheMonth() {
            const firstDayOfTheMonth = new Date(`${this.displayedYear}-${pad(this.displayedMonth + 1)}-01T00:00:00+00:00`);
            const weekDay = firstDayOfTheMonth.getUTCDay();
            return (weekDay - parseInt(this.firstDayOfWeek) + 7) % 7;
        },
        getWeekNumber(dayInMonth) {
            return weekNumber(this.displayedYear, this.displayedMonth, dayInMonth, parseInt(this.firstDayOfWeek), parseInt(this.localeFirstDayOfYear));
        },
        genWeekNumber(weekNumber) {
            return this.$createElement('td', [
                this.$createElement('small', {
                    staticClass: 'v-date-picker-table--date__week',
                }, String(weekNumber).padStart(2, '0')),
            ]);
        },
        genTBody() {
            const children = [];
            const daysInMonth = new Date(this.displayedYear, this.displayedMonth + 1, 0).getDate();
            let rows = [];
            let day = this.weekDaysBeforeFirstDayOfTheMonth();
            if (this.showWeek) {
                rows.push(this.genWeekNumber(this.getWeekNumber(1)));
            }
            while (day--)
                rows.push(this.$createElement('td'));
            for (day = 1; day <= daysInMonth; day++) {
                const date = `${this.displayedYear}-${pad(this.displayedMonth + 1)}-${pad(day)}`;
                rows.push(this.$createElement('td', [
                    this.genButton(date, true, 'date', this.formatter),
                ]));
                if (rows.length % (this.showWeek ? 8 : 7) === 0) {
                    children.push(this.genTR(rows));
                    rows = [];
                    if (this.showWeek && (day < daysInMonth)) {
                        rows.push(this.genWeekNumber(this.getWeekNumber(day + 7)));
                    }
                }
            }
            if (rows.length) {
                children.push(this.genTR(rows));
            }
            return this.$createElement('tbody', children);
        },
        genTR(children) {
            return [this.$createElement('tr', children)];
        },
    },
    render() {
        return this.genTable('v-date-picker-table v-date-picker-table--date', [
            this.genTHead(),
            this.genTBody(),
        ], this.calculateTableDate);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGVQaWNrZXJEYXRlVGFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0ZVBpY2tlci9WRGF0ZVBpY2tlckRhdGVUYWJsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTO0FBQ1QsT0FBTyxlQUFlLE1BQU0sNEJBQTRCLENBQUE7QUFFeEQsUUFBUTtBQUNSLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQTtBQUNyRCxPQUFPLEVBQUUsR0FBRyxFQUFFLDJCQUEyQixFQUFFLFdBQVcsRUFBRSxNQUFNLFFBQVEsQ0FBQTtBQUN0RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDaEQsT0FBTyxNQUFNLE1BQU0sbUJBQW1CLENBQUE7QUFNdEMsZUFBZSxNQUFNLENBQ25CLGVBQWU7QUFDakIsb0JBQW9CO0NBQ25CLENBQUMsTUFBTSxDQUFDO0lBQ1AsSUFBSSxFQUFFLDBCQUEwQjtJQUVoQyxLQUFLLEVBQUU7UUFDTCxjQUFjLEVBQUU7WUFDZCxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1lBQ3RCLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFDRCxvQkFBb0IsRUFBRTtZQUNwQixJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1lBQ3RCLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFDRCxRQUFRLEVBQUUsT0FBTztRQUNqQixhQUFhLEVBQUUsUUFBcUQ7S0FDckU7SUFFRCxRQUFRLEVBQUU7UUFDUixTQUFTO1lBQ1AsT0FBTyxJQUFJLENBQUMsTUFBTSxJQUFJLDJCQUEyQixDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUE7UUFD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QUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO29CQUMvQixJQUFJLEdBQUcsRUFBRSxDQUFBO29CQUNULElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxDQUFDLEdBQUcsR0FBRyxXQUFXLENBQUMsRUFBRTt3QkFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtxQkFDM0Q7aUJBQ0Y7YUFDRjtZQUVELElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFDZixRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTthQUNoQztZQUVELE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDL0MsQ0FBQztRQUNELEtBQUssQ0FBRSxRQUF1QjtZQUM1QixPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQTtRQUM5QyxDQUFDO0tBQ0Y7SUFFRCxNQUFNO1FBQ0osT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLCtDQUErQyxFQUFFO1lBQ3BFLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDZixJQUFJLENBQUMsUUFBUSxFQUFFO1NBQ2hCLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUE7SUFDN0IsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIE1peGluc1xuaW1wb3J0IERhdGVQaWNrZXJUYWJsZSBmcm9tICcuL21peGlucy9kYXRlLXBpY2tlci10YWJsZSdcblxuLy8gVXRpbHNcbmltcG9ydCB7IHdlZWtOdW1iZXIgfSBmcm9tICcuLi8uLi91dGlsL2RhdGVUaW1lVXRpbHMnXG5pbXBvcnQgeyBwYWQsIGNyZWF0ZU5hdGl2ZUxvY2FsZUZvcm1hdHRlciwgbW9udGhDaGFuZ2UgfSBmcm9tICcuL3V0aWwnXG5pbXBvcnQgeyBjcmVhdGVSYW5nZSB9IGZyb20gJy4uLy4uL3V0aWwvaGVscGVycydcbmltcG9ydCBtaXhpbnMgZnJvbSAnLi4vLi4vdXRpbC9taXhpbnMnXG5cbi8vIFR5cGVzXG5pbXBvcnQgeyBWTm9kZSwgVk5vZGVDaGlsZHJlbiwgUHJvcFR5cGUgfSBmcm9tICd2dWUnXG5pbXBvcnQgeyBEYXRlUGlja2VyRm9ybWF0dGVyIH0gZnJvbSAndHlwZXMnXG5cbmV4cG9ydCBkZWZhdWx0IG1peGlucyhcbiAgRGF0ZVBpY2tlclRhYmxlXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xuKS5leHRlbmQoe1xuICBuYW1lOiAndi1kYXRlLXBpY2tlci1kYXRlLXRhYmxlJyxcblxuICBwcm9wczoge1xuICAgIGZpcnN0RGF5T2ZXZWVrOiB7XG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLFxuICAgICAgZGVmYXVsdDogMCxcbiAgICB9LFxuICAgIGxvY2FsZUZpcnN0RGF5T2ZZZWFyOiB7XG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLFxuICAgICAgZGVmYXVsdDogMCxcbiAgICB9LFxuICAgIHNob3dXZWVrOiBCb29sZWFuLFxuICAgIHdlZWtkYXlGb3JtYXQ6IEZ1bmN0aW9uIGFzIFByb3BUeXBlPERhdGVQaWNrZXJGb3JtYXR0ZXIgfCB1bmRlZmluZWQ+LFxuICB9LFxuXG4gIGNvbXB1dGVkOiB7XG4gICAgZm9ybWF0dGVyICgpOiBEYXRlUGlja2VyRm9ybWF0dGVyIHtcbiAgICAgIHJldHVybiB0aGlzLmZvcm1hdCB8fCBjcmVhdGVOYXRpdmVMb2NhbGVGb3JtYXR0ZXIodGhpcy5jdXJyZW50TG9jYWxlLCB7IGRheTogJ251bWVyaWMnLCB0aW1lWm9uZTogJ1VUQycgfSwgeyBzdGFydDogOCwgbGVuZ3RoOiAyIH0pXG4gICAgfSxcbiAgICB3ZWVrZGF5Rm9ybWF0dGVyICgpOiBEYXRlUGlja2VyRm9ybWF0dGVyIHwgdW5kZWZpbmVkIHtcbiAgICAgIHJldHVybiB0aGlzLndlZWtkYXlGb3JtYXQgfHwgY3JlYXRlTmF0aXZlTG9jYWxlRm9ybWF0dGVyKHRoaXMuY3VycmVudExvY2FsZSwgeyB3ZWVrZGF5OiAnbmFycm93JywgdGltZVpvbmU6ICdVVEMnIH0pXG4gICAgfSxcbiAgICB3ZWVrRGF5cyAoKTogc3RyaW5nW10ge1xuICAgICAgY29uc3QgZmlyc3QgPSBwYXJzZUludCh0aGlzLmZpcnN0RGF5T2ZXZWVrLCAxMClcblxuICAgICAgcmV0dXJuIHRoaXMud2Vla2RheUZvcm1hdHRlclxuICAgICAgICA/IGNyZWF0ZVJhbmdlKDcpLm1hcChpID0+IHRoaXMud2Vla2RheUZvcm1hdHRlciEoYDIwMTctMDEtJHtmaXJzdCArIGkgKyAxNX1gKSkgLy8gMjAxNy0wMS0xNSBpcyBTdW5kYXlcbiAgICAgICAgOiBjcmVhdGVSYW5nZSg3KS5tYXAoaSA9PiBbJ1MnLCAnTScsICdUJywgJ1cnLCAnVCcsICdGJywgJ1MnXVsoaSArIGZpcnN0KSAlIDddKVxuICAgIH0sXG4gIH0sXG5cbiAgbWV0aG9kczoge1xuICAgIGNhbGN1bGF0ZVRhYmxlRGF0ZSAoZGVsdGE6IG51bWJlcikge1xuICAgICAgcmV0dXJuIG1vbnRoQ2hhbmdlKHRoaXMudGFibGVEYXRlLCBNYXRoLnNpZ24oZGVsdGEgfHwgMSkpXG4gICAgfSxcbiAgICBnZW5USGVhZCAoKSB7XG4gICAgICBjb25zdCBkYXlzID0gdGhpcy53ZWVrRGF5cy5tYXAoZGF5ID0+IHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3RoJywgZGF5KSlcbiAgICAgIGlmICh0aGlzLnNob3dXZWVrKSB7XG4gICAgICAgIGRheXMudW5zaGlmdCh0aGlzLiRjcmVhdGVFbGVtZW50KCd0aCcpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgndGhlYWQnLCB0aGlzLmdlblRSKGRheXMpKVxuICAgIH0sXG4gICAgLy8gUmV0dXJucyBudW1iZXIgb2YgdGhlIGRheXMgZnJvbSB0aGUgZmlyc3REYXlPZldlZWsgdG8gdGhlIGZpcnN0IGRheSBvZiB0aGUgY3VycmVudCBtb250aFxuICAgIHdlZWtEYXlzQmVmb3JlRmlyc3REYXlPZlRoZU1vbnRoICgpIHtcbiAgICAgIGNvbnN0IGZpcnN0RGF5T2ZUaGVNb250aCA9IG5ldyBEYXRlKGAke3RoaXMuZGlzcGxheWVkWWVhcn0tJHtwYWQodGhpcy5kaXNwbGF5ZWRNb250aCArIDEpfS0wMVQwMDowMDowMCswMDowMGApXG4gICAgICBjb25zdCB3ZWVrRGF5ID0gZmlyc3REYXlPZlRoZU1vbnRoLmdldFVUQ0RheSgpXG5cbiAgICAgIHJldHVybiAod2Vla0RheSAtIHBhcnNlSW50KHRoaXMuZmlyc3REYXlPZldlZWspICsgNykgJSA3XG4gICAgfSxcbiAgICBnZXRXZWVrTnVtYmVyIChkYXlJbk1vbnRoOiBudW1iZXIpIHtcbiAgICAgIHJldHVybiB3ZWVrTnVtYmVyKFxuICAgICAgICB0aGlzLmRpc3BsYXllZFllYXIsXG4gICAgICAgIHRoaXMuZGlzcGxheWVkTW9udGgsXG4gICAgICAgIGRheUluTW9udGgsXG4gICAgICAgIHBhcnNlSW50KHRoaXMuZmlyc3REYXlPZldlZWspLFxuICAgICAgICBwYXJzZUludCh0aGlzLmxvY2FsZUZpcnN0RGF5T2ZZZWFyKVxuICAgICAgKVxuICAgIH0sXG4gICAgZ2VuV2Vla051bWJlciAod2Vla051bWJlcjogbnVtYmVyKSB7XG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgndGQnLCBbXG4gICAgICAgIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3NtYWxsJywge1xuICAgICAgICAgIHN0YXRpY0NsYXNzOiAndi1kYXRlLXBpY2tlci10YWJsZS0tZGF0ZV9fd2VlaycsXG4gICAgICAgIH0sIFN0cmluZyh3ZWVrTnVtYmVyKS5wYWRTdGFydCgyLCAnMCcpKSxcbiAgICAgIF0pXG4gICAgfSxcbiAgICBnZW5UQm9keSAoKSB7XG4gICAgICBjb25zdCBjaGlsZHJlbiA9IFtdXG4gICAgICBjb25zdCBkYXlzSW5Nb250aCA9IG5ldyBEYXRlKHRoaXMuZGlzcGxheWVkWWVhciwgdGhpcy5kaXNwbGF5ZWRNb250aCArIDEsIDApLmdldERhdGUoKVxuICAgICAgbGV0IHJvd3MgPSBbXVxuICAgICAgbGV0IGRheSA9IHRoaXMud2Vla0RheXNCZWZvcmVGaXJzdERheU9mVGhlTW9udGgoKVxuXG4gICAgICBpZiAodGhpcy5zaG93V2Vlaykge1xuICAgICAgICByb3dzLnB1c2godGhpcy5nZW5XZWVrTnVtYmVyKHRoaXMuZ2V0V2Vla051bWJlcigxKSkpXG4gICAgICB9XG5cbiAgICAgIHdoaWxlIChkYXktLSkgcm93cy5wdXNoKHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3RkJykpXG4gICAgICBmb3IgKGRheSA9IDE7IGRheSA8PSBkYXlzSW5Nb250aDsgZGF5KyspIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IGAke3RoaXMuZGlzcGxheWVkWWVhcn0tJHtwYWQodGhpcy5kaXNwbGF5ZWRNb250aCArIDEpfS0ke3BhZChkYXkpfWBcblxuICAgICAgICByb3dzLnB1c2godGhpcy4kY3JlYXRlRWxlbWVudCgndGQnLCBbXG4gICAgICAgICAgdGhpcy5nZW5CdXR0b24oZGF0ZSwgdHJ1ZSwgJ2RhdGUnLCB0aGlzLmZvcm1hdHRlciksXG4gICAgICAgIF0pKVxuXG4gICAgICAgIGlmIChyb3dzLmxlbmd0aCAlICh0aGlzLnNob3dXZWVrID8gOCA6IDcpID09PSAwKSB7XG4gICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLmdlblRSKHJvd3MpKVxuICAgICAgICAgIHJvd3MgPSBbXVxuICAgICAgICAgIGlmICh0aGlzLnNob3dXZWVrICYmIChkYXkgPCBkYXlzSW5Nb250aCkpIHtcbiAgICAgICAgICAgIHJvd3MucHVzaCh0aGlzLmdlbldlZWtOdW1iZXIodGhpcy5nZXRXZWVrTnVtYmVyKGRheSArIDcpKSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHJvd3MubGVuZ3RoKSB7XG4gICAgICAgIGNoaWxkcmVuLnB1c2godGhpcy5nZW5UUihyb3dzKSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3Rib2R5JywgY2hpbGRyZW4pXG4gICAgfSxcbiAgICBnZW5UUiAoY2hpbGRyZW46IFZOb2RlQ2hpbGRyZW4pIHtcbiAgICAgIHJldHVybiBbdGhpcy4kY3JlYXRlRWxlbWVudCgndHInLCBjaGlsZHJlbildXG4gICAgfSxcbiAgfSxcblxuICByZW5kZXIgKCk6IFZOb2RlIHtcbiAgICByZXR1cm4gdGhpcy5nZW5UYWJsZSgndi1kYXRlLXBpY2tlci10YWJsZSB2LWRhdGUtcGlja2VyLXRhYmxlLS1kYXRlJywgW1xuICAgICAgdGhpcy5nZW5USGVhZCgpLFxuICAgICAgdGhpcy5nZW5UQm9keSgpLFxuICAgIF0sIHRoaXMuY2FsY3VsYXRlVGFibGVEYXRlKVxuICB9LFxufSlcbiJdfQ==