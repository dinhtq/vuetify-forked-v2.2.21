import '../VDatePickerTable.sass';
// Directives
import Touch from '../../../directives/touch';
// Mixins
import Colorable from '../../../mixins/colorable';
import Localable from '../../../mixins/localable';
import Themeable from '../../../mixins/themeable';
// Utils
import isDateAllowed from '../util/isDateAllowed';
import mixins from '../../../util/mixins';
export default mixins(Colorable, Localable, Themeable
/* @vue/component */
).extend({
    directives: { Touch },
    props: {
        allowedDates: Function,
        current: String,
        disabled: Boolean,
        format: Function,
        events: {
            type: [Array, Function, Object],
            default: () => null,
        },
        eventColor: {
            type: [Array, Function, Object, String],
            default: () => 'warning',
        },
        min: String,
        max: String,
        range: Boolean,
        readonly: Boolean,
        scrollable: Boolean,
        tableDate: {
            type: String,
            required: true,
        },
        value: [String, Array],
    },
    data: () => ({
        isReversing: false,
    }),
    computed: {
        computedTransition() {
            return (this.isReversing === !this.$vuetify.rtl) ? 'tab-reverse-transition' : 'tab-transition';
        },
        displayedMonth() {
            return Number(this.tableDate.split('-')[1]) - 1;
        },
        displayedYear() {
            return Number(this.tableDate.split('-')[0]);
        },
    },
    watch: {
        tableDate(newVal, oldVal) {
            this.isReversing = newVal < oldVal;
        },
    },
    methods: {
        genButtonClasses(isAllowed, isFloating, isSelected, isCurrent) {
            return {
                'v-size--default': !isFloating,
                'v-date-picker-table__current': isCurrent,
                'v-btn--active': isSelected,
                'v-btn--flat': !isAllowed || this.disabled,
                'v-btn--text': isSelected === isCurrent,
                'v-btn--rounded': isFloating,
                'v-btn--disabled': !isAllowed || this.disabled,
                'v-btn--outlined': isCurrent && !isSelected,
                ...this.themeClasses,
            };
        },
        genButtonEvents(value, isAllowed, mouseEventType) {
            if (this.disabled)
                return undefined;
            return {
                click: () => {
                    isAllowed && !this.readonly && this.$emit('input', value);
                    this.$emit(`click:${mouseEventType}`, value);
                },
                dblclick: () => this.$emit(`dblclick:${mouseEventType}`, value),
            };
        },
        genButton(value, isFloating, mouseEventType, formatter) {
            const isAllowed = isDateAllowed(value, this.min, this.max, this.allowedDates);
            const isSelected = this.isSelected(value);
            const isCurrent = value === this.current;
            const setColor = isSelected ? this.setBackgroundColor : this.setTextColor;
            const color = (isSelected || isCurrent) && (this.color || 'accent');
            return this.$createElement('button', setColor(color, {
                staticClass: 'v-btn',
                class: this.genButtonClasses(isAllowed, isFloating, isSelected, isCurrent),
                attrs: {
                    type: 'button',
                },
                domProps: {
                    disabled: this.disabled || !isAllowed,
                },
                on: this.genButtonEvents(value, isAllowed, mouseEventType),
            }), [
                this.$createElement('div', {
                    staticClass: 'v-btn__content',
                }, [formatter(value)]),
                this.genEvents(value),
            ]);
        },
        getEventColors(date) {
            const arrayize = (v) => Array.isArray(v) ? v : [v];
            let eventData;
            let eventColors = [];
            if (Array.isArray(this.events)) {
                eventData = this.events.includes(date);
            }
            else if (this.events instanceof Function) {
                eventData = this.events(date) || false;
            }
            else if (this.events) {
                eventData = this.events[date] || false;
            }
            else {
                eventData = false;
            }
            if (!eventData) {
                return [];
            }
            else if (eventData !== true) {
                eventColors = arrayize(eventData);
            }
            else if (typeof this.eventColor === 'string') {
                eventColors = [this.eventColor];
            }
            else if (typeof this.eventColor === 'function') {
                eventColors = arrayize(this.eventColor(date));
            }
            else if (Array.isArray(this.eventColor)) {
                eventColors = this.eventColor;
            }
            else {
                eventColors = arrayize(this.eventColor[date]);
            }
            return eventColors.filter(v => v);
        },
        genEvents(date) {
            const eventColors = this.getEventColors(date);
            return eventColors.length ? this.$createElement('div', {
                staticClass: 'v-date-picker-table__events',
            }, eventColors.map(color => this.$createElement('div', this.setBackgroundColor(color)))) : null;
        },
        wheel(e, calculateTableDate) {
            e.preventDefault();
            this.$emit('update:table-date', calculateTableDate(e.deltaY));
        },
        touch(value, calculateTableDate) {
            this.$emit('update:table-date', calculateTableDate(value));
        },
        genTable(staticClass, children, calculateTableDate) {
            const transition = this.$createElement('transition', {
                props: { name: this.computedTransition },
            }, [this.$createElement('table', { key: this.tableDate }, children)]);
            const touchDirective = {
                name: 'touch',
                value: {
                    left: (e) => (e.offsetX < -15) && this.touch(1, calculateTableDate),
                    right: (e) => (e.offsetX > 15) && this.touch(-1, calculateTableDate),
                },
            };
            return this.$createElement('div', {
                staticClass,
                class: {
                    'v-date-picker-table--disabled': this.disabled,
                    ...this.themeClasses,
                },
                on: (!this.disabled && this.scrollable) ? {
                    wheel: (e) => this.wheel(e, calculateTableDate),
                } : undefined,
                directives: [touchDirective],
            }, [transition]);
        },
        isSelected(value) {
            if (Array.isArray(this.value)) {
                if (this.range && this.value.length === 2) {
                    const [from, to] = [...this.value].sort();
                    return from <= value && value <= to;
                }
                else {
                    return this.value.indexOf(value) !== -1;
                }
            }
            return value === this.value;
        },
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXItdGFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0ZVBpY2tlci9taXhpbnMvZGF0ZS1waWNrZXItdGFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTywwQkFBMEIsQ0FBQTtBQUVqQyxhQUFhO0FBQ2IsT0FBTyxLQUFLLE1BQU0sMkJBQTJCLENBQUE7QUFFN0MsU0FBUztBQUNULE9BQU8sU0FBUyxNQUFNLDJCQUEyQixDQUFBO0FBQ2pELE9BQU8sU0FBUyxNQUFNLDJCQUEyQixDQUFBO0FBQ2pELE9BQU8sU0FBUyxNQUFNLDJCQUEyQixDQUFBO0FBRWpELFFBQVE7QUFDUixPQUFPLGFBQWEsTUFBTSx1QkFBdUIsQ0FBQTtBQUNqRCxPQUFPLE1BQU0sTUFBTSxzQkFBc0IsQ0FBQTtBQVF6QyxlQUFlLE1BQU0sQ0FDbkIsU0FBUyxFQUNULFNBQVMsRUFDVCxTQUFTO0FBQ1gsb0JBQW9CO0NBQ25CLENBQUMsTUFBTSxDQUFDO0lBQ1AsVUFBVSxFQUFFLEVBQUUsS0FBSyxFQUFFO0lBRXJCLEtBQUssRUFBRTtRQUNMLFlBQVksRUFBRSxRQUFnRTtRQUM5RSxPQUFPLEVBQUUsTUFBTTtRQUNmLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLE1BQU0sRUFBRSxRQUFxRDtRQUM3RCxNQUFNLEVBQUU7WUFDTixJQUFJLEVBQUUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBK0I7WUFDN0QsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUk7U0FDcEI7UUFDRCxVQUFVLEVBQUU7WUFDVixJQUFJLEVBQUUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQW9DO1lBQzFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxTQUFTO1NBQ3pCO1FBQ0QsR0FBRyxFQUFFLE1BQU07UUFDWCxHQUFHLEVBQUUsTUFBTTtRQUNYLEtBQUss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O29CQUN6QyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7b0JBQ3pDLE9BQU8sSUFBSSxJQUFJLEtBQUssSUFBSSxLQUFLLElBQUksRUFBRSxDQUFBO2lCQUNwQztxQkFBTTtvQkFDTCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO2lCQUN4QzthQUNGO1lBRUQsT0FBTyxLQUFLLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUM3QixDQUFDO0tBQ0Y7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJy4uL1ZEYXRlUGlja2VyVGFibGUuc2FzcydcblxuLy8gRGlyZWN0aXZlc1xuaW1wb3J0IFRvdWNoIGZyb20gJy4uLy4uLy4uL2RpcmVjdGl2ZXMvdG91Y2gnXG5cbi8vIE1peGluc1xuaW1wb3J0IENvbG9yYWJsZSBmcm9tICcuLi8uLi8uLi9taXhpbnMvY29sb3JhYmxlJ1xuaW1wb3J0IExvY2FsYWJsZSBmcm9tICcuLi8uLi8uLi9taXhpbnMvbG9jYWxhYmxlJ1xuaW1wb3J0IFRoZW1lYWJsZSBmcm9tICcuLi8uLi8uLi9taXhpbnMvdGhlbWVhYmxlJ1xuXG4vLyBVdGlsc1xuaW1wb3J0IGlzRGF0ZUFsbG93ZWQgZnJvbSAnLi4vdXRpbC9pc0RhdGVBbGxvd2VkJ1xuaW1wb3J0IG1peGlucyBmcm9tICcuLi8uLi8uLi91dGlsL21peGlucydcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlQ2hpbGRyZW4sIFByb3BUeXBlIH0gZnJvbSAndnVlJ1xuaW1wb3J0IHsgRGF0ZVBpY2tlckFsbG93ZWREYXRlc0Z1bmN0aW9uLCBEYXRlUGlja2VyRm9ybWF0dGVyLCBEYXRlUGlja2VyRXZlbnRzLCBEYXRlUGlja2VyRXZlbnRDb2xvcnMsIERhdGVQaWNrZXJFdmVudENvbG9yVmFsdWUsIFRvdWNoV3JhcHBlciB9IGZyb20gJ3R5cGVzJ1xuXG50eXBlIENhbGN1bGF0ZVRhYmxlRGF0ZUZ1bmN0aW9uID0gKHY6IG51bWJlcikgPT4gc3RyaW5nXG5cbmV4cG9ydCBkZWZhdWx0IG1peGlucyhcbiAgQ29sb3JhYmxlLFxuICBMb2NhbGFibGUsXG4gIFRoZW1lYWJsZVxuLyogQHZ1ZS9jb21wb25lbnQgKi9cbikuZXh0ZW5kKHtcbiAgZGlyZWN0aXZlczogeyBUb3VjaCB9LFxuXG4gIHByb3BzOiB7XG4gICAgYWxsb3dlZERhdGVzOiBGdW5jdGlvbiBhcyBQcm9wVHlwZTxEYXRlUGlja2VyQWxsb3dlZERhdGVzRnVuY3Rpb24gfCB1bmRlZmluZWQ+LFxuICAgIGN1cnJlbnQ6IFN0cmluZyxcbiAgICBkaXNhYmxlZDogQm9vbGVhbixcbiAgICBmb3JtYXQ6IEZ1bmN0aW9uIGFzIFByb3BUeXBlPERhdGVQaWNrZXJGb3JtYXR0ZXIgfCB1bmRlZmluZWQ+LFxuICAgIGV2ZW50czoge1xuICAgICAgdHlwZTogW0FycmF5LCBGdW5jdGlvbiwgT2JqZWN0XSBhcyBQcm9wVHlwZTxEYXRlUGlja2VyRXZlbnRzPixcbiAgICAgIGRlZmF1bHQ6ICgpID0+IG51bGwsXG4gICAgfSxcbiAgICBldmVudENvbG9yOiB7XG4gICAgICB0eXBlOiBbQXJyYXksIEZ1bmN0aW9uLCBPYmplY3QsIFN0cmluZ10gYXMgUHJvcFR5cGU8RGF0ZVBpY2tlckV2ZW50Q29sb3JzPixcbiAgICAgIGRlZmF1bHQ6ICgpID0+ICd3YXJuaW5nJyxcbiAgICB9LFxuICAgIG1pbjogU3RyaW5nLFxuICAgIG1heDogU3RyaW5nLFxuICAgIHJhbmdlOiBCb29sZWFuLFxuICAgIHJlYWRvbmx5OiBCb29sZWFuLFxuICAgIHNjcm9sbGFibGU6IEJvb2xlYW4sXG4gICAgdGFibGVEYXRlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICB9LFxuICAgIHZhbHVlOiBbU3RyaW5nLCBBcnJheV0gYXMgUHJvcFR5cGU8c3RyaW5nIHwgc3RyaW5nW10+LFxuICB9LFxuXG4gIGRhdGE6ICgpID0+ICh7XG4gICAgaXNSZXZlcnNpbmc6IGZhbHNlLFxuICB9KSxcblxuICBjb21wdXRlZDoge1xuICAgIGNvbXB1dGVkVHJhbnNpdGlvbiAoKTogc3RyaW5nIHtcbiAgICAgIHJldHVybiAodGhpcy5pc1JldmVyc2luZyA9PT0gIXRoaXMuJHZ1ZXRpZnkucnRsKSA/ICd0YWItcmV2ZXJzZS10cmFuc2l0aW9uJyA6ICd0YWItdHJhbnNpdGlvbidcbiAgICB9LFxuICAgIGRpc3BsYXllZE1vbnRoICgpOiBudW1iZXIge1xuICAgICAgcmV0dXJuIE51bWJlcih0aGlzLnRhYmxlRGF0ZS5zcGxpdCgnLScpWzFdKSAtIDFcbiAgICB9LFxuICAgIGRpc3BsYXllZFllYXIgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gTnVtYmVyKHRoaXMudGFibGVEYXRlLnNwbGl0KCctJylbMF0pXG4gICAgfSxcbiAgfSxcblxuICB3YXRjaDoge1xuICAgIHRhYmxlRGF0ZSAobmV3VmFsOiBzdHJpbmcsIG9sZFZhbDogc3RyaW5nKSB7XG4gICAgICB0aGlzLmlzUmV2ZXJzaW5nID0gbmV3VmFsIDwgb2xkVmFsXG4gICAgfSxcbiAgfSxcblxuICBtZXRob2RzOiB7XG4gICAgZ2VuQnV0dG9uQ2xhc3NlcyAoaXNBbGxvd2VkOiBib29sZWFuLCBpc0Zsb2F0aW5nOiBib29sZWFuLCBpc1NlbGVjdGVkOiBib29sZWFuLCBpc0N1cnJlbnQ6IGJvb2xlYW4pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICd2LXNpemUtLWRlZmF1bHQnOiAhaXNGbG9hdGluZyxcbiAgICAgICAgJ3YtZGF0ZS1waWNrZXItdGFibGVfX2N1cnJlbnQnOiBpc0N1cnJlbnQsXG4gICAgICAgICd2LWJ0bi0tYWN0aXZlJzogaXNTZWxlY3RlZCxcbiAgICAgICAgJ3YtYnRuLS1mbGF0JzogIWlzQWxsb3dlZCB8fCB0aGlzLmRpc2FibGVkLFxuICAgICAgICAndi1idG4tLXRleHQnOiBpc1NlbGVjdGVkID09PSBpc0N1cnJlbnQsXG4gICAgICAgICd2LWJ0bi0tcm91bmRlZCc6IGlzRmxvYXRpbmcsXG4gICAgICAgICd2LWJ0bi0tZGlzYWJsZWQnOiAhaXNBbGxvd2VkIHx8IHRoaXMuZGlzYWJsZWQsXG4gICAgICAgICd2LWJ0bi0tb3V0bGluZWQnOiBpc0N1cnJlbnQgJiYgIWlzU2VsZWN0ZWQsXG4gICAgICAgIC4uLnRoaXMudGhlbWVDbGFzc2VzLFxuICAgICAgfVxuICAgIH0sXG4gICAgZ2VuQnV0dG9uRXZlbnRzICh2YWx1ZTogc3RyaW5nLCBpc0FsbG93ZWQ6IGJvb2xlYW4sIG1vdXNlRXZlbnRUeXBlOiBzdHJpbmcpIHtcbiAgICAgIGlmICh0aGlzLmRpc2FibGVkKSByZXR1cm4gdW5kZWZpbmVkXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgaXNBbGxvd2VkICYmICF0aGlzLnJlYWRvbmx5ICYmIHRoaXMuJGVtaXQoJ2lucHV0JywgdmFsdWUpXG4gICAgICAgICAgdGhpcy4kZW1pdChgY2xpY2s6JHttb3VzZUV2ZW50VHlwZX1gLCB2YWx1ZSlcbiAgICAgICAgfSxcbiAgICAgICAgZGJsY2xpY2s6ICgpID0+IHRoaXMuJGVtaXQoYGRibGNsaWNrOiR7bW91c2VFdmVudFR5cGV9YCwgdmFsdWUpLFxuICAgICAgfVxuICAgIH0sXG4gICAgZ2VuQnV0dG9uICh2YWx1ZTogc3RyaW5nLCBpc0Zsb2F0aW5nOiBib29sZWFuLCBtb3VzZUV2ZW50VHlwZTogc3RyaW5nLCBmb3JtYXR0ZXI6IERhdGVQaWNrZXJGb3JtYXR0ZXIpIHtcbiAgICAgIGNvbnN0IGlzQWxsb3dlZCA9IGlzRGF0ZUFsbG93ZWQodmFsdWUsIHRoaXMubWluLCB0aGlzLm1heCwgdGhpcy5hbGxvd2VkRGF0ZXMpXG4gICAgICBjb25zdCBpc1NlbGVjdGVkID0gdGhpcy5pc1NlbGVjdGVkKHZhbHVlKVxuICAgICAgY29uc3QgaXNDdXJyZW50ID0gdmFsdWUgPT09IHRoaXMuY3VycmVudFxuICAgICAgY29uc3Qgc2V0Q29sb3IgPSBpc1NlbGVjdGVkID8gdGhpcy5zZXRCYWNrZ3JvdW5kQ29sb3IgOiB0aGlzLnNldFRleHRDb2xvclxuICAgICAgY29uc3QgY29sb3IgPSAoaXNTZWxlY3RlZCB8fCBpc0N1cnJlbnQpICYmICh0aGlzLmNvbG9yIHx8ICdhY2NlbnQnKVxuXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgc2V0Q29sb3IoY29sb3IsIHtcbiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LWJ0bicsXG4gICAgICAgIGNsYXNzOiB0aGlzLmdlbkJ1dHRvbkNsYXNzZXMoaXNBbGxvd2VkLCBpc0Zsb2F0aW5nLCBpc1NlbGVjdGVkLCBpc0N1cnJlbnQpLFxuICAgICAgICBhdHRyczoge1xuICAgICAgICAgIHR5cGU6ICdidXR0b24nLFxuICAgICAgICB9LFxuICAgICAgICBkb21Qcm9wczoge1xuICAgICAgICAgIGRpc2FibGVkOiB0aGlzLmRpc2FibGVkIHx8ICFpc0FsbG93ZWQsXG4gICAgICAgIH0sXG4gICAgICAgIG9uOiB0aGlzLmdlbkJ1dHRvbkV2ZW50cyh2YWx1ZSwgaXNBbGxvd2VkLCBtb3VzZUV2ZW50VHlwZSksXG4gICAgICB9KSwgW1xuICAgICAgICB0aGlzLiRjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgc3RhdGljQ2xhc3M6ICd2LWJ0bl9fY29udGVudCcsXG4gICAgICAgIH0sIFtmb3JtYXR0ZXIodmFsdWUpXSksXG4gICAgICAgIHRoaXMuZ2VuRXZlbnRzKHZhbHVlKSxcbiAgICAgIF0pXG4gICAgfSxcbiAgICBnZXRFdmVudENvbG9ycyAoZGF0ZTogc3RyaW5nKSB7XG4gICAgICBjb25zdCBhcnJheWl6ZSA9ICh2OiBzdHJpbmcgfCBzdHJpbmdbXSkgPT4gQXJyYXkuaXNBcnJheSh2KSA/IHYgOiBbdl1cbiAgICAgIGxldCBldmVudERhdGE6IGJvb2xlYW4gfCBEYXRlUGlja2VyRXZlbnRDb2xvclZhbHVlXG4gICAgICBsZXQgZXZlbnRDb2xvcnM6IHN0cmluZ1tdID0gW11cblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5ldmVudHMpKSB7XG4gICAgICAgIGV2ZW50RGF0YSA9IHRoaXMuZXZlbnRzLmluY2x1ZGVzKGRhdGUpXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZXZlbnRzIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcbiAgICAgICAgZXZlbnREYXRhID0gdGhpcy5ldmVudHMoZGF0ZSkgfHwgZmFsc2VcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5ldmVudHMpIHtcbiAgICAgICAgZXZlbnREYXRhID0gdGhpcy5ldmVudHNbZGF0ZV0gfHwgZmFsc2VcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGV2ZW50RGF0YSA9IGZhbHNlXG4gICAgICB9XG5cbiAgICAgIGlmICghZXZlbnREYXRhKSB7XG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfSBlbHNlIGlmIChldmVudERhdGEgIT09IHRydWUpIHtcbiAgICAgICAgZXZlbnRDb2xvcnMgPSBhcnJheWl6ZShldmVudERhdGEpXG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0aGlzLmV2ZW50Q29sb3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGV2ZW50Q29sb3JzID0gW3RoaXMuZXZlbnRDb2xvcl1cbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMuZXZlbnRDb2xvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBldmVudENvbG9ycyA9IGFycmF5aXplKHRoaXMuZXZlbnRDb2xvcihkYXRlKSlcbiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmV2ZW50Q29sb3IpKSB7XG4gICAgICAgIGV2ZW50Q29sb3JzID0gdGhpcy5ldmVudENvbG9yXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBldmVudENvbG9ycyA9IGFycmF5aXplKHRoaXMuZXZlbnRDb2xvcltkYXRlXSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGV2ZW50Q29sb3JzLmZpbHRlcih2ID0+IHYpXG4gICAgfSxcbiAgICBnZW5FdmVudHMgKGRhdGU6IHN0cmluZykge1xuICAgICAgY29uc3QgZXZlbnRDb2xvcnMgPSB0aGlzLmdldEV2ZW50Q29sb3JzKGRhdGUpXG5cbiAgICAgIHJldHVybiBldmVudENvbG9ycy5sZW5ndGggPyB0aGlzLiRjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi1kYXRlLXBpY2tlci10YWJsZV9fZXZlbnRzJyxcbiAgICAgIH0sIGV2ZW50Q29sb3JzLm1hcChjb2xvciA9PiB0aGlzLiRjcmVhdGVFbGVtZW50KCdkaXYnLCB0aGlzLnNldEJhY2tncm91bmRDb2xvcihjb2xvcikpKSkgOiBudWxsXG4gICAgfSxcbiAgICB3aGVlbCAoZTogV2hlZWxFdmVudCwgY2FsY3VsYXRlVGFibGVEYXRlOiBDYWxjdWxhdGVUYWJsZURhdGVGdW5jdGlvbikge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6dGFibGUtZGF0ZScsIGNhbGN1bGF0ZVRhYmxlRGF0ZShlLmRlbHRhWSkpXG4gICAgfSxcbiAgICB0b3VjaCAodmFsdWU6IG51bWJlciwgY2FsY3VsYXRlVGFibGVEYXRlOiBDYWxjdWxhdGVUYWJsZURhdGVGdW5jdGlvbikge1xuICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOnRhYmxlLWRhdGUnLCBjYWxjdWxhdGVUYWJsZURhdGUodmFsdWUpKVxuICAgIH0sXG4gICAgZ2VuVGFibGUgKHN0YXRpY0NsYXNzOiBzdHJpbmcsIGNoaWxkcmVuOiBWTm9kZUNoaWxkcmVuLCBjYWxjdWxhdGVUYWJsZURhdGU6IENhbGN1bGF0ZVRhYmxlRGF0ZUZ1bmN0aW9uKSB7XG4gICAgICBjb25zdCB0cmFuc2l0aW9uID0gdGhpcy4kY3JlYXRlRWxlbWVudCgndHJhbnNpdGlvbicsIHtcbiAgICAgICAgcHJvcHM6IHsgbmFtZTogdGhpcy5jb21wdXRlZFRyYW5zaXRpb24gfSxcbiAgICAgIH0sIFt0aGlzLiRjcmVhdGVFbGVtZW50KCd0YWJsZScsIHsga2V5OiB0aGlzLnRhYmxlRGF0ZSB9LCBjaGlsZHJlbildKVxuXG4gICAgICBjb25zdCB0b3VjaERpcmVjdGl2ZSA9IHtcbiAgICAgICAgbmFtZTogJ3RvdWNoJyxcbiAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICBsZWZ0OiAoZTogVG91Y2hXcmFwcGVyKSA9PiAoZS5vZmZzZXRYIDwgLTE1KSAmJiB0aGlzLnRvdWNoKDEsIGNhbGN1bGF0ZVRhYmxlRGF0ZSksXG4gICAgICAgICAgcmlnaHQ6IChlOiBUb3VjaFdyYXBwZXIpID0+IChlLm9mZnNldFggPiAxNSkgJiYgdGhpcy50b3VjaCgtMSwgY2FsY3VsYXRlVGFibGVEYXRlKSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgc3RhdGljQ2xhc3MsXG4gICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgJ3YtZGF0ZS1waWNrZXItdGFibGUtLWRpc2FibGVkJzogdGhpcy5kaXNhYmxlZCxcbiAgICAgICAgICAuLi50aGlzLnRoZW1lQ2xhc3NlcyxcbiAgICAgICAgfSxcbiAgICAgICAgb246ICghdGhpcy5kaXNhYmxlZCAmJiB0aGlzLnNjcm9sbGFibGUpID8ge1xuICAgICAgICAgIHdoZWVsOiAoZTogV2hlZWxFdmVudCkgPT4gdGhpcy53aGVlbChlLCBjYWxjdWxhdGVUYWJsZURhdGUpLFxuICAgICAgICB9IDogdW5kZWZpbmVkLFxuICAgICAgICBkaXJlY3RpdmVzOiBbdG91Y2hEaXJlY3RpdmVdLFxuICAgICAgfSwgW3RyYW5zaXRpb25dKVxuICAgIH0sXG4gICAgaXNTZWxlY3RlZCAodmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkpIHtcbiAgICAgICAgaWYgKHRoaXMucmFuZ2UgJiYgdGhpcy52YWx1ZS5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICBjb25zdCBbZnJvbSwgdG9dID0gWy4uLnRoaXMudmFsdWVdLnNvcnQoKVxuICAgICAgICAgIHJldHVybiBmcm9tIDw9IHZhbHVlICYmIHZhbHVlIDw9IHRvXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUuaW5kZXhPZih2YWx1ZSkgIT09IC0xXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZhbHVlID09PSB0aGlzLnZhbHVlXG4gICAgfSxcbiAgfSxcbn0pXG4iXX0=