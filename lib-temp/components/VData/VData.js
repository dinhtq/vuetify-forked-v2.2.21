// Helpers
import { wrapInArray, sortItems, deepEqual, groupItems, searchItems } from '../../util/helpers';
import Vue from 'vue';
export default Vue.extend({
    name: 'v-data',
    inheritAttrs: false,
    props: {
        items: {
            type: Array,
            default: () => [],
        },
        options: {
            type: Object,
            default: () => ({}),
        },
        sortBy: {
            type: [String, Array],
            default: () => [],
        },
        sortDesc: {
            type: [Boolean, Array],
            default: () => [],
        },
        customSort: {
            type: Function,
            default: sortItems,
        },
        mustSort: Boolean,
        multiSort: Boolean,
        page: {
            type: Number,
            default: 1,
        },
        itemsPerPage: {
            type: Number,
            default: 10,
        },
        groupBy: {
            type: [String, Array],
            default: () => [],
        },
        groupDesc: {
            type: [Boolean, Array],
            default: () => [],
        },
        customGroup: {
            type: Function,
            default: groupItems,
        },
        locale: {
            type: String,
            default: 'en-US',
        },
        disableSort: Boolean,
        disablePagination: Boolean,
        disableFiltering: Boolean,
        search: String,
        customFilter: {
            type: Function,
            default: searchItems,
        },
        serverItemsLength: {
            type: Number,
            default: -1,
        },
    },
    data() {
        let internalOptions = {
            page: this.page,
            itemsPerPage: this.itemsPerPage,
            sortBy: wrapInArray(this.sortBy),
            sortDesc: wrapInArray(this.sortDesc),
            groupBy: wrapInArray(this.groupBy),
            groupDesc: wrapInArray(this.groupDesc),
            mustSort: this.mustSort,
            multiSort: this.multiSort,
        };
        if (this.options) {
            internalOptions = Object.assign(internalOptions, this.options);
        }
        return {
            internalOptions,
        };
    },
    computed: {
        itemsLength() {
            return this.serverItemsLength >= 0 ? this.serverItemsLength : this.filteredItems.length;
        },
        pageCount() {
            return this.internalOptions.itemsPerPage <= 0
                ? 1
                : Math.ceil(this.itemsLength / this.internalOptions.itemsPerPage);
        },
        pageStart() {
            if (this.internalOptions.itemsPerPage === -1 || !this.items.length)
                return 0;
            return (this.internalOptions.page - 1) * this.internalOptions.itemsPerPage;
        },
        pageStop() {
            if (this.internalOptions.itemsPerPage === -1)
                return this.itemsLength;
            if (!this.items.length)
                return 0;
            return Math.min(this.itemsLength, this.internalOptions.page * this.internalOptions.itemsPerPage);
        },
        isGrouped() {
            return !!this.internalOptions.groupBy.length;
        },
        pagination() {
            return {
                page: this.internalOptions.page,
                itemsPerPage: this.internalOptions.itemsPerPage,
                pageStart: this.pageStart,
                pageStop: this.pageStop,
                pageCount: this.pageCount,
                itemsLength: this.itemsLength,
            };
        },
        filteredItems() {
            let items = this.items.slice();
            if (!this.disableFiltering && this.serverItemsLength <= 0) {
                items = this.customFilter(items, this.search);
            }
            return items;
        },
        computedItems() {
            let items = this.filteredItems.slice();
            if (!this.disableSort && this.serverItemsLength <= 0) {
                items = this.sortItems(items);
            }
            if (!this.disablePagination && this.serverItemsLength <= 0) {
                items = this.paginateItems(items);
            }
            return items;
        },
        groupedItems() {
            return this.isGrouped ? this.groupItems(this.computedItems) : null;
        },
        scopedProps() {
            const props = {
                sort: this.sort,
                sortArray: this.sortArray,
                group: this.group,
                items: this.computedItems,
                options: this.internalOptions,
                updateOptions: this.updateOptions,
                pagination: this.pagination,
                groupedItems: this.groupedItems,
                originalItemsLength: this.items.length,
            };
            return props;
        },
        computedOptions() {
            return { ...this.options };
        },
    },
    watch: {
        computedOptions: {
            handler(options, old) {
                if (deepEqual(options, old))
                    return;
                this.updateOptions(options);
            },
            deep: true,
            immediate: true,
        },
        internalOptions: {
            handler(options, old) {
                if (deepEqual(options, old))
                    return;
                this.$emit('update:options', options);
            },
            deep: true,
            immediate: true,
        },
        page(page) {
            this.updateOptions({ page });
        },
        'internalOptions.page'(page) {
            this.$emit('update:page', page);
        },
        itemsPerPage(itemsPerPage) {
            this.updateOptions({ itemsPerPage });
        },
        'internalOptions.itemsPerPage'(itemsPerPage) {
            this.$emit('update:items-per-page', itemsPerPage);
        },
        sortBy(sortBy) {
            this.updateOptions({ sortBy: wrapInArray(sortBy) });
        },
        'internalOptions.sortBy'(sortBy, old) {
            !deepEqual(sortBy, old) && this.$emit('update:sort-by', Array.isArray(this.sortBy) ? sortBy : sortBy[0]);
        },
        sortDesc(sortDesc) {
            this.updateOptions({ sortDesc: wrapInArray(sortDesc) });
        },
        'internalOptions.sortDesc'(sortDesc, old) {
            !deepEqual(sortDesc, old) && this.$emit('update:sort-desc', Array.isArray(this.sortDesc) ? sortDesc : sortDesc[0]);
        },
        groupBy(groupBy) {
            this.updateOptions({ groupBy: wrapInArray(groupBy) });
        },
        'internalOptions.groupBy'(groupBy, old) {
            !deepEqual(groupBy, old) && this.$emit('update:group-by', Array.isArray(this.groupBy) ? groupBy : groupBy[0]);
        },
        groupDesc(groupDesc) {
            this.updateOptions({ groupDesc: wrapInArray(groupDesc) });
        },
        'internalOptions.groupDesc'(groupDesc, old) {
            !deepEqual(groupDesc, old) && this.$emit('update:group-desc', Array.isArray(this.groupDesc) ? groupDesc : groupDesc[0]);
        },
        multiSort(multiSort) {
            this.updateOptions({ multiSort });
        },
        'internalOptions.multiSort'(multiSort) {
            this.$emit('update:multi-sort', multiSort);
        },
        mustSort(mustSort) {
            this.updateOptions({ mustSort });
        },
        'internalOptions.mustSort'(mustSort) {
            this.$emit('update:must-sort', mustSort);
        },
        pageCount: {
            handler(pageCount) {
                this.$emit('page-count', pageCount);
            },
            immediate: true,
        },
        computedItems: {
            handler(computedItems) {
                this.$emit('current-items', computedItems);
            },
            immediate: true,
        },
        pagination: {
            handler(pagination, old) {
                if (deepEqual(pagination, old))
                    return;
                this.$emit('pagination', this.pagination);
            },
            immediate: true,
        },
    },
    methods: {
        toggle(key, oldBy, oldDesc, page, mustSort, multiSort) {
            let by = oldBy.slice();
            let desc = oldDesc.slice();
            const byIndex = by.findIndex((k) => k === key);
            if (byIndex < 0) {
                if (!multiSort) {
                    by = [];
                    desc = [];
                }
                by.push(key);
                desc.push(false);
            }
            else if (byIndex >= 0 && !desc[byIndex]) {
                desc[byIndex] = true;
            }
            else if (!mustSort) {
                by.splice(byIndex, 1);
                desc.splice(byIndex, 1);
            }
            else {
                desc[byIndex] = false;
            }
            // Reset page to 1 if sortBy or sortDesc have changed
            if (!deepEqual(by, oldBy) || !deepEqual(desc, oldDesc)) {
                page = 1;
            }
            return { by, desc, page };
        },
        group(key) {
            const { by: groupBy, desc: groupDesc, page } = this.toggle(key, this.internalOptions.groupBy, this.internalOptions.groupDesc, this.internalOptions.page, true, false);
            this.updateOptions({ groupBy, groupDesc, page });
        },
        sort(key) {
            if (Array.isArray(key))
                return this.sortArray(key);
            const { by: sortBy, desc: sortDesc, page } = this.toggle(key, this.internalOptions.sortBy, this.internalOptions.sortDesc, this.internalOptions.page, this.mustSort, this.multiSort);
            this.updateOptions({ sortBy, sortDesc, page });
        },
        sortArray(sortBy) {
            const sortDesc = sortBy.map(s => {
                const i = this.internalOptions.sortBy.findIndex((k) => k === s);
                return i > -1 ? this.internalOptions.sortDesc[i] : false;
            });
            this.updateOptions({ sortBy, sortDesc });
        },
        updateOptions(options) {
            this.internalOptions = {
                ...this.internalOptions,
                ...options,
                page: this.serverItemsLength < 0
                    ? Math.max(1, Math.min(options.page || this.internalOptions.page, this.pageCount))
                    : options.page || this.internalOptions.page,
            };
        },
        sortItems(items) {
            let sortBy = this.internalOptions.sortBy;
            let sortDesc = this.internalOptions.sortDesc;
            if (this.internalOptions.groupBy.length) {
                sortBy = [...this.internalOptions.groupBy, ...sortBy];
                sortDesc = [...this.internalOptions.groupDesc, ...sortDesc];
            }
            return this.customSort(items, sortBy, sortDesc, this.locale);
        },
        groupItems(items) {
            return this.customGroup(items, this.internalOptions.groupBy, this.internalOptions.groupDesc);
        },
        paginateItems(items) {
            // Make sure we don't try to display non-existant page if items suddenly change
            // TODO: Could possibly move this to pageStart/pageStop?
            if (this.serverItemsLength === -1 && items.length <= this.pageStart) {
                this.internalOptions.page = Math.max(1, this.internalOptions.page - 1);
            }
            return items.slice(this.pageStart, this.pageStop);
        },
    },
    render() {
        return this.$scopedSlots.default && this.$scopedSlots.default(this.scopedProps);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0YS9WRGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxVQUFVO0FBQ1YsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUMvRixPQUFPLEdBQWMsTUFBTSxLQUFLLENBQUE7QUFjaEMsZUFBZSxHQUFHLENBQUMsTUFBTSxDQUFDO0lBQ3hCLElBQUksRUFBRSxRQUFRO0lBRWQsWUFBWSxFQUFFLEtBQUs7SUFFbkIsS0FBSyxFQUFFO1FBQ0wsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLEtBQXdCO1lBQzlCLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFO1NBQ2xCO1FBQ0QsT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7U0FDbUI7UUFDeEMsTUFBTSxFQUFFO1lBQ04sSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBZ0M7WUFDcEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUU7U0FDbEI7UUFDRCxRQUFRLEVBQUU7WUFDUixJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFrQztZQUN2RCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRTtTQUNsQjtRQUNELFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxRQUFzQztZQUM1QyxPQUFPLEVBQUUsU0FBUztTQUNuQjtRQUNELFFBQVEsRUFBRSxPQUFPO1FBQ2pCLFNBQVMsRUFBRSxPQUFPO1FBQ2xCLElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNELFlBQVksRUFBRTtZQUNaLElBQUksRUFBRSxNQUFNO1lBQ1os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QUFRLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUE7YUFDNUQ7WUFFRCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQzlELENBQUM7UUFDRCxVQUFVLENBQUUsS0FBWTtZQUN0QixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDOUYsQ0FBQztRQUNELGFBQWEsQ0FBRSxLQUFZO1lBQ3pCLCtFQUErRTtZQUMvRSx3REFBd0Q7WUFDeEQsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEtBQUssQ0FBQyxDQUFDLElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO2dCQUNuRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQTthQUN2RTtZQUVELE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUNuRCxDQUFDO0tBQ0Y7SUFFRCxNQUFNO1FBQ0osT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFRLENBQUE7SUFDeEYsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIEhlbHBlcnNcbmltcG9ydCB7IHdyYXBJbkFycmF5LCBzb3J0SXRlbXMsIGRlZXBFcXVhbCwgZ3JvdXBJdGVtcywgc2VhcmNoSXRlbXMgfSBmcm9tICcuLi8uLi91dGlsL2hlbHBlcnMnXG5pbXBvcnQgVnVlLCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHtcbiAgRGF0YU9wdGlvbnMsXG4gIERhdGFQYWdpbmF0aW9uLFxuICBEYXRhU2NvcGVQcm9wcyxcbiAgRGF0YVNvcnRGdW5jdGlvbixcbiAgRGF0YUdyb3VwRnVuY3Rpb24sXG4gIERhdGFTZWFyY2hGdW5jdGlvbixcbiAgSXRlbUdyb3VwLFxufSBmcm9tICd0eXBlcydcbmltcG9ydCB7IFByb3BWYWxpZGF0b3IsIFByb3BUeXBlIH0gZnJvbSAndnVlL3R5cGVzL29wdGlvbnMnXG5cbmV4cG9ydCBkZWZhdWx0IFZ1ZS5leHRlbmQoe1xuICBuYW1lOiAndi1kYXRhJyxcblxuICBpbmhlcml0QXR0cnM6IGZhbHNlLFxuXG4gIHByb3BzOiB7XG4gICAgaXRlbXM6IHtcbiAgICAgIHR5cGU6IEFycmF5IGFzIFByb3BUeXBlPGFueVtdPixcbiAgICAgIGRlZmF1bHQ6ICgpID0+IFtdLFxuICAgIH0sXG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogT2JqZWN0LFxuICAgICAgZGVmYXVsdDogKCkgPT4gKHt9KSxcbiAgICB9IGFzIFByb3BWYWxpZGF0b3I8UGFydGlhbDxEYXRhT3B0aW9ucz4+LFxuICAgIHNvcnRCeToge1xuICAgICAgdHlwZTogW1N0cmluZywgQXJyYXldIGFzIFByb3BUeXBlPHN0cmluZyB8IHN0cmluZ1tdPixcbiAgICAgIGRlZmF1bHQ6ICgpID0+IFtdLFxuICAgIH0sXG4gICAgc29ydERlc2M6IHtcbiAgICAgIHR5cGU6IFtCb29sZWFuLCBBcnJheV0gYXMgUHJvcFR5cGU8Ym9vbGVhbiB8IGJvb2xlYW5bXT4sXG4gICAgICBkZWZhdWx0OiAoKSA9PiBbXSxcbiAgICB9LFxuICAgIGN1c3RvbVNvcnQ6IHtcbiAgICAgIHR5cGU6IEZ1bmN0aW9uIGFzIFByb3BUeXBlPERhdGFTb3J0RnVuY3Rpb24+LFxuICAgICAgZGVmYXVsdDogc29ydEl0ZW1zLFxuICAgIH0sXG4gICAgbXVzdFNvcnQ6IEJvb2xlYW4sXG4gICAgbXVsdGlTb3J0OiBCb29sZWFuLFxuICAgIHBhZ2U6IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIGRlZmF1bHQ6IDEsXG4gICAgfSxcbiAgICBpdGVtc1BlclBhZ2U6IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIGRlZmF1bHQ6IDEwLFxuICAgIH0sXG4gICAgZ3JvdXBCeToge1xuICAgICAgdHlwZTogW1N0cmluZywgQXJyYXldIGFzIFByb3BUeXBlPHN0cmluZyB8IHN0cmluZ1tdPixcbiAgICAgIGRlZmF1bHQ6ICgpID0+IFtdLFxuICAgIH0sXG4gICAgZ3JvdXBEZXNjOiB7XG4gICAgICB0eXBlOiBbQm9vbGVhbiwgQXJyYXldIGFzIFByb3BUeXBlPGJvb2xlYW4gfCBib29sZWFuW10+LFxuICAgICAgZGVmYXVsdDogKCkgPT4gW10sXG4gICAgfSxcbiAgICBjdXN0b21Hcm91cDoge1xuICAgICAgdHlwZTogRnVuY3Rpb24gYXMgUHJvcFR5cGU8RGF0YUdyb3VwRnVuY3Rpb24+LFxuICAgICAgZGVmYXVsdDogZ3JvdXBJdGVtcyxcbiAgICB9LFxuICAgIGxvY2FsZToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ2VuLVVTJyxcbiAgICB9LFxuICAgIGRpc2FibGVTb3J0OiBCb29sZWFuLFxuICAgIGRpc2FibGVQYWdpbmF0aW9uOiBCb29sZWFuLFxuICAgIGRpc2FibGVGaWx0ZXJpbmc6IEJvb2xlYW4sXG4gICAgc2VhcmNoOiBTdHJpbmcsXG4gICAgY3VzdG9tRmlsdGVyOiB7XG4gICAgICB0eXBlOiBGdW5jdGlvbiBhcyBQcm9wVHlwZTxEYXRhU2VhcmNoRnVuY3Rpb24+LFxuICAgICAgZGVmYXVsdDogc2VhcmNoSXRlbXMsXG4gICAgfSxcbiAgICBzZXJ2ZXJJdGVtc0xlbmd0aDoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogLTEsXG4gICAgfSxcbiAgfSxcblxuICBkYXRhICgpIHtcbiAgICBsZXQgaW50ZXJuYWxPcHRpb25zOiBEYXRhT3B0aW9ucyA9IHtcbiAgICAgIHBhZ2U6IHRoaXMucGFnZSxcbiAgICAgIGl0ZW1zUGVyUGFnZTogdGhpcy5pdGVtc1BlclBhZ2UsXG4gICAgICBzb3J0Qnk6IHdyYXBJbkFycmF5KHRoaXMuc29ydEJ5KSxcbiAgICAgIHNvcnREZXNjOiB3cmFwSW5BcnJheSh0aGlzLnNvcnREZXNjKSxcbiAgICAgIGdyb3VwQnk6IHdyYXBJbkFycmF5KHRoaXMuZ3JvdXBCeSksXG4gICAgICBncm91cERlc2M6IHdyYXBJbkFycmF5KHRoaXMuZ3JvdXBEZXNjKSxcbiAgICAgIG11c3RTb3J0OiB0aGlzLm11c3RTb3J0LFxuICAgICAgbXVsdGlTb3J0OiB0aGlzLm11bHRpU29ydCxcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vcHRpb25zKSB7XG4gICAgICBpbnRlcm5hbE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKGludGVybmFsT3B0aW9ucywgdGhpcy5vcHRpb25zKVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBpbnRlcm5hbE9wdGlvbnMsXG4gICAgfVxuICB9LFxuXG4gIGNvbXB1dGVkOiB7XG4gICAgaXRlbXNMZW5ndGggKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5zZXJ2ZXJJdGVtc0xlbmd0aCA+PSAwID8gdGhpcy5zZXJ2ZXJJdGVtc0xlbmd0aCA6IHRoaXMuZmlsdGVyZWRJdGVtcy5sZW5ndGhcbiAgICB9LFxuICAgIHBhZ2VDb3VudCAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiB0aGlzLmludGVybmFsT3B0aW9ucy5pdGVtc1BlclBhZ2UgPD0gMFxuICAgICAgICA/IDFcbiAgICAgICAgOiBNYXRoLmNlaWwodGhpcy5pdGVtc0xlbmd0aCAvIHRoaXMuaW50ZXJuYWxPcHRpb25zLml0ZW1zUGVyUGFnZSlcbiAgICB9LFxuICAgIHBhZ2VTdGFydCAoKTogbnVtYmVyIHtcbiAgICAgIGlmICh0aGlzLmludGVybmFsT3B0aW9ucy5pdGVtc1BlclBhZ2UgPT09IC0xIHx8ICF0aGlzLml0ZW1zLmxlbmd0aCkgcmV0dXJuIDBcblxuICAgICAgcmV0dXJuICh0aGlzLmludGVybmFsT3B0aW9ucy5wYWdlIC0gMSkgKiB0aGlzLmludGVybmFsT3B0aW9ucy5pdGVtc1BlclBhZ2VcbiAgICB9LFxuICAgIHBhZ2VTdG9wICgpOiBudW1iZXIge1xuICAgICAgaWYgKHRoaXMuaW50ZXJuYWxPcHRpb25zLml0ZW1zUGVyUGFnZSA9PT0gLTEpIHJldHVybiB0aGlzLml0ZW1zTGVuZ3RoXG4gICAgICBpZiAoIXRoaXMuaXRlbXMubGVuZ3RoKSByZXR1cm4gMFxuXG4gICAgICByZXR1cm4gTWF0aC5taW4odGhpcy5pdGVtc0xlbmd0aCwgdGhpcy5pbnRlcm5hbE9wdGlvbnMucGFnZSAqIHRoaXMuaW50ZXJuYWxPcHRpb25zLml0ZW1zUGVyUGFnZSlcbiAgICB9LFxuICAgIGlzR3JvdXBlZCAoKTogYm9vbGVhbiB7XG4gICAgICByZXR1cm4gISF0aGlzLmludGVybmFsT3B0aW9ucy5ncm91cEJ5Lmxlbmd0aFxuICAgIH0sXG4gICAgcGFnaW5hdGlvbiAoKTogRGF0YVBhZ2luYXRpb24ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGFnZTogdGhpcy5pbnRlcm5hbE9wdGlvbnMucGFnZSxcbiAgICAgICAgaXRlbXNQZXJQYWdlOiB0aGlzLmludGVybmFsT3B0aW9ucy5pdGVtc1BlclBhZ2UsXG4gICAgICAgIHBhZ2VTdGFydDogdGhpcy5wYWdlU3RhcnQsXG4gICAgICAgIHBhZ2VTdG9wOiB0aGlzLnBhZ2VTdG9wLFxuICAgICAgICBwYWdlQ291bnQ6IHRoaXMucGFnZUNvdW50LFxuICAgICAgICBpdGVtc0xlbmd0aDogdGhpcy5pdGVtc0xlbmd0aCxcbiAgICAgIH1cbiAgICB9LFxuICAgIGZpbHRlcmVkSXRlbXMgKCk6IGFueVtdIHtcbiAgICAgIGxldCBpdGVtcyA9IHRoaXMuaXRlbXMuc2xpY2UoKVxuXG4gICAgICBpZiAoIXRoaXMuZGlzYWJsZUZpbHRlcmluZyAmJiB0aGlzLnNlcnZlckl0ZW1zTGVuZ3RoIDw9IDApIHtcbiAgICAgICAgaXRlbXMgPSB0aGlzLmN1c3RvbUZpbHRlcihpdGVtcywgdGhpcy5zZWFyY2gpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpdGVtc1xuICAgIH0sXG4gICAgY29tcHV0ZWRJdGVtcyAoKTogYW55W10ge1xuICAgICAgbGV0IGl0ZW1zID0gdGhpcy5maWx0ZXJlZEl0ZW1zLnNsaWNlKClcblxuICAgICAgaWYgKCF0aGlzLmRpc2FibGVTb3J0ICYmIHRoaXMuc2VydmVySXRlbXNMZW5ndGggPD0gMCkge1xuICAgICAgICBpdGVtcyA9IHRoaXMuc29ydEl0ZW1zKGl0ZW1zKVxuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMuZGlzYWJsZVBhZ2luYXRpb24gJiYgdGhpcy5zZXJ2ZXJJdGVtc0xlbmd0aCA8PSAwKSB7XG4gICAgICAgIGl0ZW1zID0gdGhpcy5wYWdpbmF0ZUl0ZW1zKGl0ZW1zKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaXRlbXNcbiAgICB9LFxuICAgIGdyb3VwZWRJdGVtcyAoKTogSXRlbUdyb3VwPGFueT5bXSB8IG51bGwge1xuICAgICAgcmV0dXJuIHRoaXMuaXNHcm91cGVkID8gdGhpcy5ncm91cEl0ZW1zKHRoaXMuY29tcHV0ZWRJdGVtcykgOiBudWxsXG4gICAgfSxcbiAgICBzY29wZWRQcm9wcyAoKTogRGF0YVNjb3BlUHJvcHMge1xuICAgICAgY29uc3QgcHJvcHMgPSB7XG4gICAgICAgIHNvcnQ6IHRoaXMuc29ydCxcbiAgICAgICAgc29ydEFycmF5OiB0aGlzLnNvcnRBcnJheSxcbiAgICAgICAgZ3JvdXA6IHRoaXMuZ3JvdXAsXG4gICAgICAgIGl0ZW1zOiB0aGlzLmNvbXB1dGVkSXRlbXMsXG4gICAgICAgIG9wdGlvbnM6IHRoaXMuaW50ZXJuYWxPcHRpb25zLFxuICAgICAgICB1cGRhdGVPcHRpb25zOiB0aGlzLnVwZGF0ZU9wdGlvbnMsXG4gICAgICAgIHBhZ2luYXRpb246IHRoaXMucGFnaW5hdGlvbixcbiAgICAgICAgZ3JvdXBlZEl0ZW1zOiB0aGlzLmdyb3VwZWRJdGVtcyxcbiAgICAgICAgb3JpZ2luYWxJdGVtc0xlbmd0aDogdGhpcy5pdGVtcy5sZW5ndGgsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwcm9wc1xuICAgIH0sXG4gICAgY29tcHV0ZWRPcHRpb25zICgpOiBEYXRhT3B0aW9ucyB7XG4gICAgICByZXR1cm4geyAuLi50aGlzLm9wdGlvbnMgfSBhcyBEYXRhT3B0aW9uc1xuICAgIH0sXG4gIH0sXG5cbiAgd2F0Y2g6IHtcbiAgICBjb21wdXRlZE9wdGlvbnM6IHtcbiAgICAgIGhhbmRsZXIgKG9wdGlvbnM6IERhdGFPcHRpb25zLCBvbGQ6IERhdGFPcHRpb25zKSB7XG4gICAgICAgIGlmIChkZWVwRXF1YWwob3B0aW9ucywgb2xkKSkgcmV0dXJuXG5cbiAgICAgICAgdGhpcy51cGRhdGVPcHRpb25zKG9wdGlvbnMpXG4gICAgICB9LFxuICAgICAgZGVlcDogdHJ1ZSxcbiAgICAgIGltbWVkaWF0ZTogdHJ1ZSxcbiAgICB9LFxuICAgIGludGVybmFsT3B0aW9uczoge1xuICAgICAgaGFuZGxlciAob3B0aW9uczogRGF0YU9wdGlvbnMsIG9sZDogRGF0YU9wdGlvbnMpIHtcbiAgICAgICAgaWYgKGRlZXBFcXVhbChvcHRpb25zLCBvbGQpKSByZXR1cm5cbiAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOm9wdGlvbnMnLCBvcHRpb25zKVxuICAgICAgfSxcbiAgICAgIGRlZXA6IHRydWUsXG4gICAgICBpbW1lZGlhdGU6IHRydWUsXG4gICAgfSxcbiAgICBwYWdlIChwYWdlOiBudW1iZXIpIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyh7IHBhZ2UgfSlcbiAgICB9LFxuICAgICdpbnRlcm5hbE9wdGlvbnMucGFnZScgKHBhZ2U6IG51bWJlcikge1xuICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOnBhZ2UnLCBwYWdlKVxuICAgIH0sXG4gICAgaXRlbXNQZXJQYWdlIChpdGVtc1BlclBhZ2U6IG51bWJlcikge1xuICAgICAgdGhpcy51cGRhdGVPcHRpb25zKHsgaXRlbXNQZXJQYWdlIH0pXG4gICAgfSxcbiAgICAnaW50ZXJuYWxPcHRpb25zLml0ZW1zUGVyUGFnZScgKGl0ZW1zUGVyUGFnZTogbnVtYmVyKSB7XG4gICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6aXRlbXMtcGVyLXBhZ2UnLCBpdGVtc1BlclBhZ2UpXG4gICAgfSxcbiAgICBzb3J0QnkgKHNvcnRCeTogc3RyaW5nIHwgc3RyaW5nW10pIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyh7IHNvcnRCeTogd3JhcEluQXJyYXkoc29ydEJ5KSB9KVxuICAgIH0sXG4gICAgJ2ludGVybmFsT3B0aW9ucy5zb3J0QnknIChzb3J0Qnk6IHN0cmluZ1tdLCBvbGQ6IHN0cmluZ1tdKSB7XG4gICAgICAhZGVlcEVxdWFsKHNvcnRCeSwgb2xkKSAmJiB0aGlzLiRlbWl0KCd1cGRhdGU6c29ydC1ieScsIEFycmF5LmlzQXJyYXkodGhpcy5zb3J0QnkpID8gc29ydEJ5IDogc29ydEJ5WzBdKVxuICAgIH0sXG4gICAgc29ydERlc2MgKHNvcnREZXNjOiBib29sZWFuIHwgYm9vbGVhbltdKSB7XG4gICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMoeyBzb3J0RGVzYzogd3JhcEluQXJyYXkoc29ydERlc2MpIH0pXG4gICAgfSxcbiAgICAnaW50ZXJuYWxPcHRpb25zLnNvcnREZXNjJyAoc29ydERlc2M6IGJvb2xlYW5bXSwgb2xkOiBib29sZWFuW10pIHtcbiAgICAgICFkZWVwRXF1YWwoc29ydERlc2MsIG9sZCkgJiYgdGhpcy4kZW1pdCgndXBkYXRlOnNvcnQtZGVzYycsIEFycmF5LmlzQXJyYXkodGhpcy5zb3J0RGVzYykgPyBzb3J0RGVzYyA6IHNvcnREZXNjWzBdKVxuICAgIH0sXG4gICAgZ3JvdXBCeSAoZ3JvdXBCeTogc3RyaW5nIHwgc3RyaW5nW10pIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyh7IGdyb3VwQnk6IHdyYXBJbkFycmF5KGdyb3VwQnkpIH0pXG4gICAgfSxcbiAgICAnaW50ZXJuYWxPcHRpb25zLmdyb3VwQnknIChncm91cEJ5OiBzdHJpbmdbXSwgb2xkOiBzdHJpbmdbXSkge1xuICAgICAgIWRlZXBFcXVhbChncm91cEJ5LCBvbGQpICYmIHRoaXMuJGVtaXQoJ3VwZGF0ZTpncm91cC1ieScsIEFycmF5LmlzQXJyYXkodGhpcy5ncm91cEJ5KSA/IGdyb3VwQnkgOiBncm91cEJ5WzBdKVxuICAgIH0sXG4gICAgZ3JvdXBEZXNjIChncm91cERlc2M6IGJvb2xlYW4gfCBib29sZWFuW10pIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyh7IGdyb3VwRGVzYzogd3JhcEluQXJyYXkoZ3JvdXBEZXNjKSB9KVxuICAgIH0sXG4gICAgJ2ludGVybmFsT3B0aW9ucy5ncm91cERlc2MnIChncm91cERlc2M6IGJvb2xlYW5bXSwgb2xkOiBib29sZWFuW10pIHtcbiAgICAgICFkZWVwRXF1YWwoZ3JvdXBEZXNjLCBvbGQpICYmIHRoaXMuJGVtaXQoJ3VwZGF0ZTpncm91cC1kZXNjJywgQXJyYXkuaXNBcnJheSh0aGlzLmdyb3VwRGVzYykgPyBncm91cERlc2MgOiBncm91cERlc2NbMF0pXG4gICAgfSxcbiAgICBtdWx0aVNvcnQgKG11bHRpU29ydDogYm9vbGVhbikge1xuICAgICAgdGhpcy51cGRhdGVPcHRpb25zKHsgbXVsdGlTb3J0IH0pXG4gICAgfSxcbiAgICAnaW50ZXJuYWxPcHRpb25zLm11bHRpU29ydCcgKG11bHRpU29ydDogYm9vbGVhbikge1xuICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOm11bHRpLXNvcnQnLCBtdWx0aVNvcnQpXG4gICAgfSxcbiAgICBtdXN0U29ydCAobXVzdFNvcnQ6IGJvb2xlYW4pIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyh7IG11c3RTb3J0IH0pXG4gICAgfSxcbiAgICAnaW50ZXJuYWxPcHRpb25zLm11c3RTb3J0JyAobXVzdFNvcnQ6IGJvb2xlYW4pIHtcbiAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZTptdXN0LXNvcnQnLCBtdXN0U29ydClcbiAgICB9LFxuICAgIHBhZ2VDb3VudDoge1xuICAgICAgaGFuZGxlciAocGFnZUNvdW50OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy4kZW1pdCgncGFnZS1jb3VudCcsIHBhZ2VDb3VudClcbiAgICAgIH0sXG4gICAgICBpbW1lZGlhdGU6IHRydWUsXG4gICAgfSxcbiAgICBjb21wdXRlZEl0ZW1zOiB7XG4gICAgICBoYW5kbGVyIChjb21wdXRlZEl0ZW1zOiBhbnlbXSkge1xuICAgICAgICB0aGlzLiRlbWl0KCdjdXJyZW50LWl0ZW1zJywgY29tcHV0ZWRJdGVtcylcbiAgICAgIH0sXG4gICAgICBpbW1lZGlhdGU6IHRydWUsXG4gICAgfSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBoYW5kbGVyIChwYWdpbmF0aW9uOiBEYXRhUGFnaW5hdGlvbiwgb2xkOiBEYXRhUGFnaW5hdGlvbikge1xuICAgICAgICBpZiAoZGVlcEVxdWFsKHBhZ2luYXRpb24sIG9sZCkpIHJldHVyblxuICAgICAgICB0aGlzLiRlbWl0KCdwYWdpbmF0aW9uJywgdGhpcy5wYWdpbmF0aW9uKVxuICAgICAgfSxcbiAgICAgIGltbWVkaWF0ZTogdHJ1ZSxcbiAgICB9LFxuICB9LFxuXG4gIG1ldGhvZHM6IHtcbiAgICB0b2dnbGUgKGtleTogc3RyaW5nLCBvbGRCeTogc3RyaW5nW10sIG9sZERlc2M6IGJvb2xlYW5bXSwgcGFnZTogbnVtYmVyLCBtdXN0U29ydDogYm9vbGVhbiwgbXVsdGlTb3J0OiBib29sZWFuKSB7XG4gICAgICBsZXQgYnkgPSBvbGRCeS5zbGljZSgpXG4gICAgICBsZXQgZGVzYyA9IG9sZERlc2Muc2xpY2UoKVxuICAgICAgY29uc3QgYnlJbmRleCA9IGJ5LmZpbmRJbmRleCgoazogc3RyaW5nKSA9PiBrID09PSBrZXkpXG5cbiAgICAgIGlmIChieUluZGV4IDwgMCkge1xuICAgICAgICBpZiAoIW11bHRpU29ydCkge1xuICAgICAgICAgIGJ5ID0gW11cbiAgICAgICAgICBkZXNjID0gW11cbiAgICAgICAgfVxuXG4gICAgICAgIGJ5LnB1c2goa2V5KVxuICAgICAgICBkZXNjLnB1c2goZmFsc2UpXG4gICAgICB9IGVsc2UgaWYgKGJ5SW5kZXggPj0gMCAmJiAhZGVzY1tieUluZGV4XSkge1xuICAgICAgICBkZXNjW2J5SW5kZXhdID0gdHJ1ZVxuICAgICAgfSBlbHNlIGlmICghbXVzdFNvcnQpIHtcbiAgICAgICAgYnkuc3BsaWNlKGJ5SW5kZXgsIDEpXG4gICAgICAgIGRlc2Muc3BsaWNlKGJ5SW5kZXgsIDEpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZXNjW2J5SW5kZXhdID0gZmFsc2VcbiAgICAgIH1cblxuICAgICAgLy8gUmVzZXQgcGFnZSB0byAxIGlmIHNvcnRCeSBvciBzb3J0RGVzYyBoYXZlIGNoYW5nZWRcbiAgICAgIGlmICghZGVlcEVxdWFsKGJ5LCBvbGRCeSkgfHwgIWRlZXBFcXVhbChkZXNjLCBvbGREZXNjKSkge1xuICAgICAgICBwYWdlID0gMVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBieSwgZGVzYywgcGFnZSB9XG4gICAgfSxcbiAgICBncm91cCAoa2V5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgIGNvbnN0IHsgYnk6IGdyb3VwQnksIGRlc2M6IGdyb3VwRGVzYywgcGFnZSB9ID0gdGhpcy50b2dnbGUoXG4gICAgICAgIGtleSxcbiAgICAgICAgdGhpcy5pbnRlcm5hbE9wdGlvbnMuZ3JvdXBCeSxcbiAgICAgICAgdGhpcy5pbnRlcm5hbE9wdGlvbnMuZ3JvdXBEZXNjLFxuICAgICAgICB0aGlzLmludGVybmFsT3B0aW9ucy5wYWdlLFxuICAgICAgICB0cnVlLFxuICAgICAgICBmYWxzZVxuICAgICAgKVxuICAgICAgdGhpcy51cGRhdGVPcHRpb25zKHsgZ3JvdXBCeSwgZ3JvdXBEZXNjLCBwYWdlIH0pXG4gICAgfSxcbiAgICBzb3J0IChrZXk6IHN0cmluZyB8IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShrZXkpKSByZXR1cm4gdGhpcy5zb3J0QXJyYXkoa2V5KVxuXG4gICAgICBjb25zdCB7IGJ5OiBzb3J0QnksIGRlc2M6IHNvcnREZXNjLCBwYWdlIH0gPSB0aGlzLnRvZ2dsZShcbiAgICAgICAga2V5LFxuICAgICAgICB0aGlzLmludGVybmFsT3B0aW9ucy5zb3J0QnksXG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcHRpb25zLnNvcnREZXNjLFxuICAgICAgICB0aGlzLmludGVybmFsT3B0aW9ucy5wYWdlLFxuICAgICAgICB0aGlzLm11c3RTb3J0LFxuICAgICAgICB0aGlzLm11bHRpU29ydFxuICAgICAgKVxuICAgICAgdGhpcy51cGRhdGVPcHRpb25zKHsgc29ydEJ5LCBzb3J0RGVzYywgcGFnZSB9KVxuICAgIH0sXG4gICAgc29ydEFycmF5IChzb3J0Qnk6IHN0cmluZ1tdKSB7XG4gICAgICBjb25zdCBzb3J0RGVzYyA9IHNvcnRCeS5tYXAocyA9PiB7XG4gICAgICAgIGNvbnN0IGkgPSB0aGlzLmludGVybmFsT3B0aW9ucy5zb3J0QnkuZmluZEluZGV4KChrOiBzdHJpbmcpID0+IGsgPT09IHMpXG4gICAgICAgIHJldHVybiBpID4gLTEgPyB0aGlzLmludGVybmFsT3B0aW9ucy5zb3J0RGVzY1tpXSA6IGZhbHNlXG4gICAgICB9KVxuXG4gICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMoeyBzb3J0QnksIHNvcnREZXNjIH0pXG4gICAgfSxcbiAgICB1cGRhdGVPcHRpb25zIChvcHRpb25zOiBhbnkpIHtcbiAgICAgIHRoaXMuaW50ZXJuYWxPcHRpb25zID0ge1xuICAgICAgICAuLi50aGlzLmludGVybmFsT3B0aW9ucyxcbiAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgcGFnZTogdGhpcy5zZXJ2ZXJJdGVtc0xlbmd0aCA8IDBcbiAgICAgICAgICA/IE1hdGgubWF4KDEsIE1hdGgubWluKG9wdGlvbnMucGFnZSB8fCB0aGlzLmludGVybmFsT3B0aW9ucy5wYWdlLCB0aGlzLnBhZ2VDb3VudCkpXG4gICAgICAgICAgOiBvcHRpb25zLnBhZ2UgfHwgdGhpcy5pbnRlcm5hbE9wdGlvbnMucGFnZSxcbiAgICAgIH1cbiAgICB9LFxuICAgIHNvcnRJdGVtcyAoaXRlbXM6IGFueVtdKSB7XG4gICAgICBsZXQgc29ydEJ5ID0gdGhpcy5pbnRlcm5hbE9wdGlvbnMuc29ydEJ5XG4gICAgICBsZXQgc29ydERlc2MgPSB0aGlzLmludGVybmFsT3B0aW9ucy5zb3J0RGVzY1xuXG4gICAgICBpZiAodGhpcy5pbnRlcm5hbE9wdGlvbnMuZ3JvdXBCeS5sZW5ndGgpIHtcbiAgICAgICAgc29ydEJ5ID0gWy4uLnRoaXMuaW50ZXJuYWxPcHRpb25zLmdyb3VwQnksIC4uLnNvcnRCeV1cbiAgICAgICAgc29ydERlc2MgPSBbLi4udGhpcy5pbnRlcm5hbE9wdGlvbnMuZ3JvdXBEZXNjLCAuLi5zb3J0RGVzY11cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tU29ydChpdGVtcywgc29ydEJ5LCBzb3J0RGVzYywgdGhpcy5sb2NhbGUpXG4gICAgfSxcbiAgICBncm91cEl0ZW1zIChpdGVtczogYW55W10pIHtcbiAgICAgIHJldHVybiB0aGlzLmN1c3RvbUdyb3VwKGl0ZW1zLCB0aGlzLmludGVybmFsT3B0aW9ucy5ncm91cEJ5LCB0aGlzLmludGVybmFsT3B0aW9ucy5ncm91cERlc2MpXG4gICAgfSxcbiAgICBwYWdpbmF0ZUl0ZW1zIChpdGVtczogYW55W10pIHtcbiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBkb24ndCB0cnkgdG8gZGlzcGxheSBub24tZXhpc3RhbnQgcGFnZSBpZiBpdGVtcyBzdWRkZW5seSBjaGFuZ2VcbiAgICAgIC8vIFRPRE86IENvdWxkIHBvc3NpYmx5IG1vdmUgdGhpcyB0byBwYWdlU3RhcnQvcGFnZVN0b3A/XG4gICAgICBpZiAodGhpcy5zZXJ2ZXJJdGVtc0xlbmd0aCA9PT0gLTEgJiYgaXRlbXMubGVuZ3RoIDw9IHRoaXMucGFnZVN0YXJ0KSB7XG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcHRpb25zLnBhZ2UgPSBNYXRoLm1heCgxLCB0aGlzLmludGVybmFsT3B0aW9ucy5wYWdlIC0gMSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGl0ZW1zLnNsaWNlKHRoaXMucGFnZVN0YXJ0LCB0aGlzLnBhZ2VTdG9wKVxuICAgIH0sXG4gIH0sXG5cbiAgcmVuZGVyICgpOiBWTm9kZSB7XG4gICAgcmV0dXJuIHRoaXMuJHNjb3BlZFNsb3RzLmRlZmF1bHQgJiYgdGhpcy4kc2NvcGVkU2xvdHMuZGVmYXVsdCh0aGlzLnNjb3BlZFByb3BzKSBhcyBhbnlcbiAgfSxcbn0pXG4iXX0=