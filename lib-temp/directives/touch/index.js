import { keys } from '../../util/helpers';
const handleGesture = (wrapper) => {
    const { touchstartX, touchendX, touchstartY, touchendY } = wrapper;
    const dirRatio = 0.5;
    const minDistance = 16;
    wrapper.offsetX = touchendX - touchstartX;
    wrapper.offsetY = touchendY - touchstartY;
    if (Math.abs(wrapper.offsetY) < dirRatio * Math.abs(wrapper.offsetX)) {
        wrapper.left && (touchendX < touchstartX - minDistance) && wrapper.left(wrapper);
        wrapper.right && (touchendX > touchstartX + minDistance) && wrapper.right(wrapper);
    }
    if (Math.abs(wrapper.offsetX) < dirRatio * Math.abs(wrapper.offsetY)) {
        wrapper.up && (touchendY < touchstartY - minDistance) && wrapper.up(wrapper);
        wrapper.down && (touchendY > touchstartY + minDistance) && wrapper.down(wrapper);
    }
};
function touchstart(event, wrapper) {
    const touch = event.changedTouches[0];
    wrapper.touchstartX = touch.clientX;
    wrapper.touchstartY = touch.clientY;
    wrapper.start &&
        wrapper.start(Object.assign(event, wrapper));
}
function touchend(event, wrapper) {
    const touch = event.changedTouches[0];
    wrapper.touchendX = touch.clientX;
    wrapper.touchendY = touch.clientY;
    wrapper.end &&
        wrapper.end(Object.assign(event, wrapper));
    handleGesture(wrapper);
}
function touchmove(event, wrapper) {
    const touch = event.changedTouches[0];
    wrapper.touchmoveX = touch.clientX;
    wrapper.touchmoveY = touch.clientY;
    wrapper.move && wrapper.move(Object.assign(event, wrapper));
}
function createHandlers(value) {
    const wrapper = {
        touchstartX: 0,
        touchstartY: 0,
        touchendX: 0,
        touchendY: 0,
        touchmoveX: 0,
        touchmoveY: 0,
        offsetX: 0,
        offsetY: 0,
        left: value.left,
        right: value.right,
        up: value.up,
        down: value.down,
        start: value.start,
        move: value.move,
        end: value.end,
    };
    return {
        touchstart: (e) => touchstart(e, wrapper),
        touchend: (e) => touchend(e, wrapper),
        touchmove: (e) => touchmove(e, wrapper),
    };
}
function inserted(el, binding, vnode) {
    const value = binding.value;
    const target = value.parent ? el.parentElement : el;
    const options = value.options || { passive: true };
    // Needed to pass unit tests
    if (!target)
        return;
    const handlers = createHandlers(binding.value);
    target._touchHandlers = Object(target._touchHandlers);
    target._touchHandlers[vnode.context._uid] = handlers;
    keys(handlers).forEach(eventName => {
        target.addEventListener(eventName, handlers[eventName], options);
    });
}
function unbind(el, binding, vnode) {
    const target = binding.value.parent ? el.parentElement : el;
    if (!target || !target._touchHandlers)
        return;
    const handlers = target._touchHandlers[vnode.context._uid];
    keys(handlers).forEach(eventName => {
        target.removeEventListener(eventName, handlers[eventName]);
    });
    delete target._touchHandlers[vnode.context._uid];
}
export const Touch = {
    inserted,
    unbind,
};
export default Touch;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZGlyZWN0aXZlcy90b3VjaC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFhekMsTUFBTSxhQUFhLEdBQUcsQ0FBQyxPQUFxQixFQUFFLEVBQUU7SUFDOUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxHQUFHLE9BQU8sQ0FBQTtJQUNsRSxNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUE7SUFDcEIsTUFBTSxXQUFXLEdBQUcsRUFBRSxDQUFBO0lBQ3RCLE9BQU8sQ0FBQyxPQUFPLEdBQUcsU0FBUyxHQUFHLFdBQVcsQ0FBQTtJQUN6QyxPQUFPLENBQUMsT0FBTyxHQUFHLFNBQVMsR0FBRyxXQUFXLENBQUE7SUFFekMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDcEUsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsR0FBRyxXQUFXLEdBQUcsV0FBVyxDQUFDLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNoRixPQUFPLENBQUMsS0FBSyxJQUFJLENBQUMsU0FBUyxHQUFHLFdBQVcsR0FBRyxXQUFXLENBQUMsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0tBQ25GO0lBRUQsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDcEUsT0FBTyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsR0FBRyxXQUFXLEdBQUcsV0FBVyxDQUFDLElBQUksT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUM1RSxPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxHQUFHLFdBQVcsR0FBRyxXQUFXLENBQUMsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0tBQ2pGO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsU0FBUyxVQUFVLENBQUUsS0FBaUIsRUFBRSxPQUFxQjtJQUMzRCxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ3JDLE9BQU8sQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQTtJQUNuQyxPQUFPLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUE7SUFFbkMsT0FBTyxDQUFDLEtBQUs7UUFDWCxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUE7QUFDaEQsQ0FBQztBQUVELFNBQVMsUUFBUSxDQUFFLEtBQWlCLEVBQUUsT0FBcUI7SUFDekQsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNyQyxPQUFPLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUE7SUFDakMsT0FBTyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFBO0lBRWpDLE9BQU8sQ0FBQyxHQUFHO1FBQ1QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFBO0lBRTVDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUN4QixDQUFDO0FBRUQsU0FBUyxTQUFTLENBQUUsS0FBaUIsRUFBRSxPQUFxQjtJQUMxRCxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ3JDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQTtJQUNsQyxPQUFPLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUE7SUFFbEMsT0FBTyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUE7QUFDN0QsQ0FBQztBQUVELFNBQVMsY0FBYyxDQUFFLEtBQW9CO0lBQzNDLE1BQU0sT0FBTyxHQUFHO1FBQ2QsV0FBVyxFQUFFLENBQUM7UUFDZCxXQUFXLEVBQUUsQ0FBQztRQUNkLFNBQVMsRUFBRSxDQUFDO1FBQ1osU0FBUyxFQUFFLENBQUM7UUFDWixVQUFVLEVBQUUsQ0FBQztRQUNiLFVBQVUsRUFBRSxDQUFDO1FBQ2IsT0FBTyxFQUFFLENBQUM7UUFDVixPQUFPLEVBQUUsQ0FBQztRQUNWLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSTtRQUNoQixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7UUFDbEIsRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFFO1FBQ1osSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO1FBQ2hCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztRQUNsQixJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUk7UUFDaEIsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHO0tBQ2YsQ0FBQTtJQUVELE9BQU87UUFDTCxVQUFVLEVBQUUsQ0FBQyxDQUFhLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDO1FBQ3JELFFBQVEsRUFBRSxDQUFDLENBQWEsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUM7UUFDakQsU0FBUyxFQUFFLENBQUMsQ0FBYSxFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQztLQUNwRCxDQUFBO0FBQ0gsQ0FBQztBQUVELFNBQVMsUUFBUSxDQUFFLEVBQWUsRUFBRSxPQUE0QixFQUFFLEtBQVk7SUFDNUUsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQU0sQ0FBQTtJQUM1QixNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUE7SUFDbkQsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sSUFBSSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQTtJQUVsRCw0QkFBNEI7SUFDNUIsSUFBSSxDQUFDLE1BQU07UUFBRSxPQUFNO0lBRW5CLE1BQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMsS0FBTSxDQUFDLENBQUE7SUFDL0MsTUFBTSxDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFBO0lBQ3JELE1BQU0sQ0FBQyxjQUFlLENBQUMsS0FBSyxDQUFDLE9BQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxRQUFRLENBQUE7SUFFdEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRTtRQUNqQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQWtCLEVBQUUsT0FBTyxDQUFDLENBQUE7SUFDbkYsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDO0FBRUQsU0FBUyxNQUFNLENBQUUsRUFBZSxFQUFFLE9BQTRCLEVBQUUsS0FBWTtJQUMxRSxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsS0FBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBO0lBQzVELElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYztRQUFFLE9BQU07SUFFN0MsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsT0FBUSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzNELElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUU7UUFDakMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTtJQUM1RCxDQUFDLENBQUMsQ0FBQTtJQUNGLE9BQU8sTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsT0FBUSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ25ELENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxLQUFLLEdBQUc7SUFDbkIsUUFBUTtJQUNSLE1BQU07Q0FDUCxDQUFBO0FBRUQsZUFBZSxLQUFLLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWTm9kZURpcmVjdGl2ZSwgVk5vZGUgfSBmcm9tICd2dWUvdHlwZXMvdm5vZGUnXG5pbXBvcnQgeyBrZXlzIH0gZnJvbSAnLi4vLi4vdXRpbC9oZWxwZXJzJ1xuaW1wb3J0IHsgVG91Y2hIYW5kbGVycywgVG91Y2hWYWx1ZSwgVG91Y2hXcmFwcGVyIH0gZnJvbSAndHlwZXMnXG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91Y2hTdG9yZWRIYW5kbGVycyB7XG4gIHRvdWNoc3RhcnQ6IChlOiBUb3VjaEV2ZW50KSA9PiB2b2lkXG4gIHRvdWNoZW5kOiAoZTogVG91Y2hFdmVudCkgPT4gdm9pZFxuICB0b3VjaG1vdmU6IChlOiBUb3VjaEV2ZW50KSA9PiB2b2lkXG59XG5cbmludGVyZmFjZSBUb3VjaFZOb2RlRGlyZWN0aXZlIGV4dGVuZHMgVk5vZGVEaXJlY3RpdmUge1xuICB2YWx1ZT86IFRvdWNoVmFsdWVcbn1cblxuY29uc3QgaGFuZGxlR2VzdHVyZSA9ICh3cmFwcGVyOiBUb3VjaFdyYXBwZXIpID0+IHtcbiAgY29uc3QgeyB0b3VjaHN0YXJ0WCwgdG91Y2hlbmRYLCB0b3VjaHN0YXJ0WSwgdG91Y2hlbmRZIH0gPSB3cmFwcGVyXG4gIGNvbnN0IGRpclJhdGlvID0gMC41XG4gIGNvbnN0IG1pbkRpc3RhbmNlID0gMTZcbiAgd3JhcHBlci5vZmZzZXRYID0gdG91Y2hlbmRYIC0gdG91Y2hzdGFydFhcbiAgd3JhcHBlci5vZmZzZXRZID0gdG91Y2hlbmRZIC0gdG91Y2hzdGFydFlcblxuICBpZiAoTWF0aC5hYnMod3JhcHBlci5vZmZzZXRZKSA8IGRpclJhdGlvICogTWF0aC5hYnMod3JhcHBlci5vZmZzZXRYKSkge1xuICAgIHdyYXBwZXIubGVmdCAmJiAodG91Y2hlbmRYIDwgdG91Y2hzdGFydFggLSBtaW5EaXN0YW5jZSkgJiYgd3JhcHBlci5sZWZ0KHdyYXBwZXIpXG4gICAgd3JhcHBlci5yaWdodCAmJiAodG91Y2hlbmRYID4gdG91Y2hzdGFydFggKyBtaW5EaXN0YW5jZSkgJiYgd3JhcHBlci5yaWdodCh3cmFwcGVyKVxuICB9XG5cbiAgaWYgKE1hdGguYWJzKHdyYXBwZXIub2Zmc2V0WCkgPCBkaXJSYXRpbyAqIE1hdGguYWJzKHdyYXBwZXIub2Zmc2V0WSkpIHtcbiAgICB3cmFwcGVyLnVwICYmICh0b3VjaGVuZFkgPCB0b3VjaHN0YXJ0WSAtIG1pbkRpc3RhbmNlKSAmJiB3cmFwcGVyLnVwKHdyYXBwZXIpXG4gICAgd3JhcHBlci5kb3duICYmICh0b3VjaGVuZFkgPiB0b3VjaHN0YXJ0WSArIG1pbkRpc3RhbmNlKSAmJiB3cmFwcGVyLmRvd24od3JhcHBlcilcbiAgfVxufVxuXG5mdW5jdGlvbiB0b3VjaHN0YXJ0IChldmVudDogVG91Y2hFdmVudCwgd3JhcHBlcjogVG91Y2hXcmFwcGVyKSB7XG4gIGNvbnN0IHRvdWNoID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF1cbiAgd3JhcHBlci50b3VjaHN0YXJ0WCA9IHRvdWNoLmNsaWVudFhcbiAgd3JhcHBlci50b3VjaHN0YXJ0WSA9IHRvdWNoLmNsaWVudFlcblxuICB3cmFwcGVyLnN0YXJ0ICYmXG4gICAgd3JhcHBlci5zdGFydChPYmplY3QuYXNzaWduKGV2ZW50LCB3cmFwcGVyKSlcbn1cblxuZnVuY3Rpb24gdG91Y2hlbmQgKGV2ZW50OiBUb3VjaEV2ZW50LCB3cmFwcGVyOiBUb3VjaFdyYXBwZXIpIHtcbiAgY29uc3QgdG91Y2ggPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXVxuICB3cmFwcGVyLnRvdWNoZW5kWCA9IHRvdWNoLmNsaWVudFhcbiAgd3JhcHBlci50b3VjaGVuZFkgPSB0b3VjaC5jbGllbnRZXG5cbiAgd3JhcHBlci5lbmQgJiZcbiAgICB3cmFwcGVyLmVuZChPYmplY3QuYXNzaWduKGV2ZW50LCB3cmFwcGVyKSlcblxuICBoYW5kbGVHZXN0dXJlKHdyYXBwZXIpXG59XG5cbmZ1bmN0aW9uIHRvdWNobW92ZSAoZXZlbnQ6IFRvdWNoRXZlbnQsIHdyYXBwZXI6IFRvdWNoV3JhcHBlcikge1xuICBjb25zdCB0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdXG4gIHdyYXBwZXIudG91Y2htb3ZlWCA9IHRvdWNoLmNsaWVudFhcbiAgd3JhcHBlci50b3VjaG1vdmVZID0gdG91Y2guY2xpZW50WVxuXG4gIHdyYXBwZXIubW92ZSAmJiB3cmFwcGVyLm1vdmUoT2JqZWN0LmFzc2lnbihldmVudCwgd3JhcHBlcikpXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUhhbmRsZXJzICh2YWx1ZTogVG91Y2hIYW5kbGVycyk6IFRvdWNoU3RvcmVkSGFuZGxlcnMge1xuICBjb25zdCB3cmFwcGVyID0ge1xuICAgIHRvdWNoc3RhcnRYOiAwLFxuICAgIHRvdWNoc3RhcnRZOiAwLFxuICAgIHRvdWNoZW5kWDogMCxcbiAgICB0b3VjaGVuZFk6IDAsXG4gICAgdG91Y2htb3ZlWDogMCxcbiAgICB0b3VjaG1vdmVZOiAwLFxuICAgIG9mZnNldFg6IDAsXG4gICAgb2Zmc2V0WTogMCxcbiAgICBsZWZ0OiB2YWx1ZS5sZWZ0LFxuICAgIHJpZ2h0OiB2YWx1ZS5yaWdodCxcbiAgICB1cDogdmFsdWUudXAsXG4gICAgZG93bjogdmFsdWUuZG93bixcbiAgICBzdGFydDogdmFsdWUuc3RhcnQsXG4gICAgbW92ZTogdmFsdWUubW92ZSxcbiAgICBlbmQ6IHZhbHVlLmVuZCxcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdG91Y2hzdGFydDogKGU6IFRvdWNoRXZlbnQpID0+IHRvdWNoc3RhcnQoZSwgd3JhcHBlciksXG4gICAgdG91Y2hlbmQ6IChlOiBUb3VjaEV2ZW50KSA9PiB0b3VjaGVuZChlLCB3cmFwcGVyKSxcbiAgICB0b3VjaG1vdmU6IChlOiBUb3VjaEV2ZW50KSA9PiB0b3VjaG1vdmUoZSwgd3JhcHBlciksXG4gIH1cbn1cblxuZnVuY3Rpb24gaW5zZXJ0ZWQgKGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogVG91Y2hWTm9kZURpcmVjdGl2ZSwgdm5vZGU6IFZOb2RlKSB7XG4gIGNvbnN0IHZhbHVlID0gYmluZGluZy52YWx1ZSFcbiAgY29uc3QgdGFyZ2V0ID0gdmFsdWUucGFyZW50ID8gZWwucGFyZW50RWxlbWVudCA6IGVsXG4gIGNvbnN0IG9wdGlvbnMgPSB2YWx1ZS5vcHRpb25zIHx8IHsgcGFzc2l2ZTogdHJ1ZSB9XG5cbiAgLy8gTmVlZGVkIHRvIHBhc3MgdW5pdCB0ZXN0c1xuICBpZiAoIXRhcmdldCkgcmV0dXJuXG5cbiAgY29uc3QgaGFuZGxlcnMgPSBjcmVhdGVIYW5kbGVycyhiaW5kaW5nLnZhbHVlISlcbiAgdGFyZ2V0Ll90b3VjaEhhbmRsZXJzID0gT2JqZWN0KHRhcmdldC5fdG91Y2hIYW5kbGVycylcbiAgdGFyZ2V0Ll90b3VjaEhhbmRsZXJzIVt2bm9kZS5jb250ZXh0IS5fdWlkXSA9IGhhbmRsZXJzXG5cbiAga2V5cyhoYW5kbGVycykuZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlcnNbZXZlbnROYW1lXSBhcyBFdmVudExpc3RlbmVyLCBvcHRpb25zKVxuICB9KVxufVxuXG5mdW5jdGlvbiB1bmJpbmQgKGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogVG91Y2hWTm9kZURpcmVjdGl2ZSwgdm5vZGU6IFZOb2RlKSB7XG4gIGNvbnN0IHRhcmdldCA9IGJpbmRpbmcudmFsdWUhLnBhcmVudCA/IGVsLnBhcmVudEVsZW1lbnQgOiBlbFxuICBpZiAoIXRhcmdldCB8fCAhdGFyZ2V0Ll90b3VjaEhhbmRsZXJzKSByZXR1cm5cblxuICBjb25zdCBoYW5kbGVycyA9IHRhcmdldC5fdG91Y2hIYW5kbGVyc1t2bm9kZS5jb250ZXh0IS5fdWlkXVxuICBrZXlzKGhhbmRsZXJzKS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoYW5kbGVyc1tldmVudE5hbWVdKVxuICB9KVxuICBkZWxldGUgdGFyZ2V0Ll90b3VjaEhhbmRsZXJzW3Zub2RlLmNvbnRleHQhLl91aWRdXG59XG5cbmV4cG9ydCBjb25zdCBUb3VjaCA9IHtcbiAgaW5zZXJ0ZWQsXG4gIHVuYmluZCxcbn1cblxuZXhwb3J0IGRlZmF1bHQgVG91Y2hcbiJdfQ==